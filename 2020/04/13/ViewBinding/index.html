<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> å…³äº ViewBinding çš„äºŒä¸‰äº‹ Â· æ–‡é’¦çš„æœèŠ±å¤•æ‹¾</title><meta name="description" content="å…³äº ViewBinding çš„äºŒä¸‰äº‹ - æ–‡é’¦"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/lewis.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="æ–‡é’¦çš„æœèŠ±å¤•æ‹¾"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/lewis.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/wenqin-231" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://wenqin231@gmail.com" target="_blank" class="nav-list-link">EMAIL</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">å…³äº ViewBinding çš„äºŒä¸‰äº‹</h1><div class="post-info">Apr 13, 2020</div><div class="post-content"><p><img src="https://i.loli.net/2020/04/11/9vzHZi6IBTcgNtA.png" alt="ViewBinding.png"></p>
<p><strong>ViewBinding</strong> æ˜¯ Android Studio 3.6 æ¨å‡ºçš„æ–°å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è½»æ¾é«˜æ•ˆåœ°ç¼–å†™ä¸ View äº¤äº’çš„ä»£ç ã€‚åœ¨å¯ç”¨åï¼Œæ ¹æ® XML å¸ƒå±€æ–‡ä»¶ä¼šç”Ÿæˆå¯¹åº”çš„ binding ç±»ï¼Œè¿™ä¸ªç±»åŒ…å«äº†å¸ƒå±€å†…æ‰€æœ‰è®¾ç½®è¿‡ id çš„ View çš„å¼•ç”¨ã€‚</p>
<p>å®˜æ–¹æ¨èä½¿ç”¨å®ƒæ¥æ›¿ä»£ <code>findVeiwById</code> ï¼›<a href="https://twitter.com/JakeWharton" target="_blank" rel="noopener">Jake Wharton</a> ä¹Ÿåœ¨ç¤¾äº¤å¹³å°ä¸Šæ¨èå®ƒæ›¿æ¢ <code>ButterKnife</code>ï¼›åœ¨ kotlinä¸­å¸¸ç”¨çš„ <code>Kotlin Synthetics</code> åˆæœ‰ä»€ä¹ˆæ¯”ä¸ä¸Šå®ƒçš„å‘¢ï¼Ÿå®ƒæœ¬èº«ä¼šä¸ä¼šæœ‰ä»€ä¹ˆå‘ï¼Ÿè®©æˆ‘ä»¬å±•å¼€è®²è®²ã€‚</p>
<a id="more"></a>
<h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><p>ç›¸æ¯”äºä¼ ç»Ÿçš„ <code>findViewById</code>ï¼Œ<code>ViewBinding</code> æœ€ç›´è§‚çš„ä¼˜åŠ¿æ˜¯å‡å°‘ä»£ç é‡ã€‚å¯¹äºè¿½æ±‚æ•ˆï¼ˆlanï¼‰ç‡ï¼ˆduoï¼‰çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™æ˜¯æœ€å¸å¼•äººçš„åœ°æ–¹ã€‚</p>
<p>è™½ç„¶ <code>ButterKnife</code> ä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶åšåˆ°è¿™ç‚¹ï¼Œä½†æ˜¯é‚£äº› <code>@BindView</code> è¿˜æ˜¯å®æ‰“å®åœ°å­˜åœ¨ä½ çš„ä»£ç ä¸­ï¼Œå¹¶ä¸”ä»¥åæ¯å¢å‡ä¸€ä¸ª widgetï¼Œä½ éƒ½éœ€è¦è€ƒè™‘é‚£äº›ç»‘å®šå…³ç³»ã€‚è€Œ <code>ViewBinding</code> æ˜¯åŠ¨æ€ç”Ÿæ•ˆçš„ï¼Œåœ¨ä½ çš„ XML å¸ƒå±€æ–‡ä»¶æ·»åŠ å®Œæ–°çš„ widget åï¼Œ<code>ViewBinding</code> ç±»å°±å¯ä»¥è°ƒç”¨å®ƒäº†ğŸ˜</p>
<p><img src="https://i.loli.net/2020/04/13/S17cR4a3olGwxVs.jpg" alt="happy.jpg"></p>
<p>æœ‰æœ‹å‹å¯èƒ½ä¼šè¯´äº†ï¼Œ<code>Kotlin Synthetics</code> åŒæ ·ä¹Ÿå‡å°‘äº†å¾ˆå¤šä»£ç é‡å‘¢ï¼è·Ÿä½ è¿™ä¸ª <code>ViewBinding</code> æ¯”èµ·æ¥ï¼Œå®ƒä¸é¦™ä¹ˆï¼Ÿé‚£è¿™é‡Œå°±ä¸å¾—ä¸æåˆ° <code>ViewBinding</code> çš„ç¬¬äºŒä¸ªä¼˜åŠ¿äº†â€”â€”å®‰å…¨ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>Kotlin Synthetics</code> æ˜¯å¯ä»¥é€šè¿‡ View æˆ–è€… Activity å¼•ç”¨åˆ°ä»»æ„ XML ä¸­çš„ widgetï¼Œå¦‚æœä¸å°å¿ƒå¼•ç”¨é”™å°±ä¼šå¯¼è‡´åº”ç”¨ crashã€‚è€Œä¸”è¿™ç§å¼‚å¸¸åœ¨ç¼–è¯‘æœŸè¿˜æ²¡æ³•è¢«å‘ç°ï¼Œåªæœ‰ç¨‹åºè¿è¡Œåˆ°ä½¿ç”¨é”™è¯¯çš„åœ°æ–¹æ‰ä¼šå‡ºç°ï¼Œè¿™å°±ç»™åº”ç”¨ç•™ä¸‹äº†å®‰å…¨éšæ‚£âš ï¸</p>
<p>è€Œ ViewBinding åˆ™ä¸å…·å¤‡è¿™æ ·çš„é—®é¢˜ï¼Œå®ƒä¿è¯äº†ä½ åªèƒ½è°ƒç”¨å¯¹åº” XML å¸ƒå±€æ–‡ä»¶çš„ widgetï¼Œç›¸å¯¹æ¥è¯´æ›´å®‰å…¨ã€‚è€Œä¸”å®ƒå…¼å®¹ Javaï¼Œè¿™å¯¹äºè¿˜æœ‰éƒ¨åˆ†ä»£ç æ²¡è¿ç§»åˆ° Kotlin çš„ä»£ç æ¥è¯´ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒå‹å¥½çš„ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:center">ViewBinding</th>
<th style="text-align:center">ButterKnife</th>
<th style="text-align:center">Kotlin Synthetics</th>
<th style="text-align:center">findViewById</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç©ºå®‰å…¨</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">â›”ï¸</td>
</tr>
<tr>
<td style="text-align:left">ä¿è¯å¼•ç”¨æ˜¯æ¥è‡ª<br>XML å¸ƒå±€æ–‡ä»¶</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">â›”ï¸</td>
</tr>
<tr>
<td style="text-align:left">æ”¯æŒ Kotlin å’Œ Java</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">âœ…</td>
</tr>
<tr>
<td style="text-align:left">ä»£ç é‡</td>
<td style="text-align:center">â¤ï¸</td>
<td style="text-align:center">ğŸ’”</td>
<td style="text-align:center">â¤ï¸</td>
<td style="text-align:center">ğŸ’”</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å°½ç®¡ ButterKnife æœ‰ä¿æŠ¤ View çš„ç©ºå®‰å…¨ï¼Œä½†æ˜¯å®ƒä¸èƒ½ä¿è¯ id æ˜¯ä¸æ˜¯æ¥è‡ªäºå£°æ˜çš„ xml</p>
</blockquote>
<p>é‚£åˆæœ‰æœ‹å‹ä¼šé—®ï¼Œä½ è¿™ä¸ªæ˜¯ä¸æ˜¯è·Ÿ <code>DataBinding</code> ä¸€æ ·å‘€ï¼æˆ‘ç”¨äº† <code>DataBinding</code> æ˜¯ä¸æ˜¯å°±ä¸éœ€è¦å®ƒäº†å‘€ï¼Ÿ</p>
<p>è™½ç„¶ä»–ä»¬ä¸¤è€…éƒ½æ˜¯ç”Ÿæˆ Binding ç±»ï¼Œä½†æ˜¯ <code>ViewBinding</code> æ›´å€¾å‘äºåœ¨ç®€å•çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œ å› æ­¤å®ƒç›¸å¯¹äº <code>DataBinding</code>  æ¥è¯´ï¼š</p>
<ul>
<li>æ— éœ€æ³¨è§£ï¼Œç¼–è¯‘æ—¶é—´æ›´å¿«</li>
<li>ä½¿ç”¨æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å¯¹ XML å¸ƒå±€æ–‡ä»¶è¿›è¡Œç‰¹æ®Šæ ‡å¿—ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®é‡Œå¯åŠ¨å®ƒéå¸¸æ–¹ä¾¿</li>
</ul>
<p>å½“ç„¶ï¼Œæ¯”èµ· <code>DataBinding</code> å®ƒä¹Ÿæœ‰äº›é™åˆ¶ï¼š</p>
<ul>
<li>ä¸æ”¯æŒå¸ƒå±€å˜é‡å’Œå¸ƒå±€è¡¨è¾¾å¼ï¼Œæ‰€ä»¥å®ƒä¸èƒ½ä» XML å¸ƒå±€æ–‡ä»¶ä¸­è·å–æ•°æ®åŠ¨æ€æ›´æ–° UI</li>
<li>ä¸æ”¯æŒåŒå‘æ•°æ®ç»‘å®š</li>
</ul>
<p>å› æ­¤ï¼Œä½ å¯ä»¥åŒæ—¶æ”¯æŒ <code>ViewBinding</code> å’Œ <code>DataBinding</code>ã€‚å¦‚æœéœ€è¦é¢å¤–çš„ç‰¹æ€§ï¼Œä½ å¯ä»¥è®© <code>DataBinding</code> æ¥å®Œæˆï¼Œè€Œç®€å•çš„åº”ç”¨å°±äº¤ç»™ <code>ViewBinding</code></p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>åœ¨ <code>build.gradle</code> ä¸­å£°æ˜ä½¿ç”¨ <code>ViewBinding</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Android Studio 3.6</span></span><br><span class="line">android &#123;</span><br><span class="line">    viewBinding &#123;</span><br><span class="line">        enabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨ Android Stduio 4.0 ä¸­ï¼Œ<code>ViewBinding</code> å·²ç»ç§»å…¥<code>buildFeatures</code> ä¸­äº†</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Android Studio 4.0</span></span><br><span class="line">android &#123;</span><br><span class="line">    buildFeatures &#123;</span><br><span class="line">        viewBinding = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å£°æ˜åï¼Œæ ¹æ®ä½ çš„ xml å‘½ååŠ¨æ€ç”Ÿæˆ **Bindingï¼Œä¾‹å¦‚ activity_home å°±ä¼šç”Ÿæˆ ActivityHomeBinding</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityHomeBinding</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    binding = ActivityHomeBinding.inflate(layoutInflater)</span><br><span class="line">    <span class="keyword">val</span> view = binding.root</span><br><span class="line">    setContentView(view)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ å·²ç» inflate äº† xmlï¼Œé‚£ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>bind(view)</code> å°† <code>ViewBinding</code> å’Œ View ç»‘å®šï¼Œè¿™ä¾¿äºæˆ‘ä»¬å¯¹è‡ªå®šä¹‰ View è¿›è¡Œé‡æ„ã€‚</p>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ä»å»å¹´å¹´åº•å¼€å§‹ï¼Œæˆ‘å°±åœ¨ Android Studio 3.6 preview ç‰ˆæœ¬ä¸Šä½¿ç”¨ <code>ViewBinding</code> å¼€å‘äº†ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹é¡¹ç›®å†…çš„å®è·µæ€è·¯ã€‚</p>
<h4 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h4><p>æœ€ç»å¸¸ä½¿ç”¨çš„ Fragmentï¼Œæˆ‘åˆ›å»ºäº† BindingFragmentï¼Œç»§æ‰¿äºé¡¹ç›®é‡ŒåŸæ¥çš„ <code>BaseFragment</code>ï¼Œè®© Binding çš„ä¸šåŠ¡å°½é‡ä¸å½±å“åŸæ¥çš„å°è£…ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingFragment</span>&lt;<span class="type">T : ViewBinding</span>&gt; : <span class="type">BaseFragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        initData().invoke(arguments ?: Bundle())</span><br><span class="line">        binding = createBinding().invoke(inflater, container, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">        setupView().invoke(binding)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">initData</span><span class="params">()</span></span>: Bundle.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setupView</span><span class="params">()</span></span>: T.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">ctx</span><span class="params">()</span></span>: Context = binding.root.context</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å­ç±»ä½¿ç”¨</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeFragment</span> : <span class="type">BindingFragment</span>&lt;<span class="type">FragmentHomeBinding</span>&gt;</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; FragmentHomeBinding &#123;</span><br><span class="line">        <span class="keyword">return</span> FragmentHomeBinding::inflate</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setupView</span><span class="params">()</span></span>: FragmentHomeBinding.() -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">        tvContent.text = <span class="string">"ViewBinding is cool"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå­ç±»ï¼Œæˆ‘åªéœ€è¦å…³å¿ƒ <code>fragment_home.xml</code> ç”Ÿæˆçš„ <code>FragmentHomeBinding</code>ï¼Œä¸éœ€è¦é¢å¤–å¯¹ <code>R.layout.fragment_home</code> è¿›è¡Œå¤„ç†ã€‚åœ¨ <code>setupView</code> ä¸­æˆ‘å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>tvContent</code>  çš„å¼•ç”¨ï¼Œå°±åƒåœ¨ä½¿ç”¨ <code>kotlin Synthetics</code> ä¸€æ ·ã€‚</p>
<h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>è‡ªå®šä¹‰ View ä¹Ÿæ˜¯ç»å¸¸ä½¿ç”¨çš„ï¼Œè¿™é‡Œæœ‰ä¸¤ç§ä½¿ç”¨æ€è·¯</p>
<p>å…ˆç”¨ <code>View#inflate</code> ç»‘å®š XML åï¼Œå†ç”¨ <code>ViewBinding#bind</code> ç»‘å®š Viewï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ <code>ViewBinding</code> æ¥æ¸²æŸ“ç›¸åº”çš„ UIï¼Œè¿™ç§æ–¹å¼æ–¹ä¾¿æˆ‘ä»¬é‡æ„å·²ç»å†™å¥½çš„ Viewï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyView</span> <span class="meta">@JvmOverloads</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, attrs: AttributeSet? = <span class="literal">null</span>, defStyleAttr: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">) : ConstraintLayout(context, attrs, defStyleAttr) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding: ViewEmptyBinding</span><br><span class="line">    </span><br><span class="line">    init &#123;</span><br><span class="line">        View.inflate(context, R.layout.view_empty, <span class="keyword">this</span>)</span><br><span class="line">        binding = ViewEmptyBinding.bind(<span class="keyword">this</span>)</span><br><span class="line">        binding.apply &#123;</span><br><span class="line">            tvTitle.text = <span class="string">"Data is emtpy"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ç§æ˜¯ä½¿ç”¨ <code>ViewBinding#inflate</code>ï¼Œè¿™ç§å°±ä¸ç”¨å…³å¿ƒ <code>R.layout.view_emty</code>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyView</span> <span class="meta">@JvmOverloads</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, attrs: AttributeSet? = <span class="literal">null</span>, defStyleAttr: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">) : ConstraintLayout(context, attrs, defStyleAttr) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding = ViewEmptyBinding.inflate(LayoutInflater.from(context), <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        binding.apply &#123;</span><br><span class="line">            tvTitle.text = <span class="string">"Data is emtpy"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h4><p>é¡¹ç›®é‡Œçš„ Adapter æ˜¯åŸºäºç¬¬ä¸‰æ–¹åº“è¿›è¡Œå°è£…çš„ï¼Œè¿™é‡Œæä¾›ä¸€ç§åŸºäº <code>RecyclerView.Adapter</code> çš„å°è£…ä½œä¸ºå‚è€ƒï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingViewHolder</span>&lt;<span class="type">VB : ViewBinding</span>&gt;</span>(<span class="keyword">val</span> vb: VB) : RecyclerView.ViewHolder(vb.root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingAdapter</span>&lt;<span class="type">VB : ViewBinding, T</span>&gt; : <span class="type">RecyclerView.Adapter</span>&lt;<span class="type">BindingViewHolder&lt;VB</span>&gt;&gt;</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">data</span>: MutableList&lt;T&gt; = arrayListOf()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateViewHolder</span><span class="params">(parent: <span class="type">ViewGroup</span>, viewType: <span class="type">Int</span>)</span></span>: BindingViewHolder&lt;VB&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingViewHolder(</span><br><span class="line">            createBinding().invoke(LayoutInflater.from(parent.context), parent, <span class="literal">false</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> = <span class="keyword">data</span>.size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">BindingViewHolder</span>&lt;<span class="type">VB</span>&gt;, position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">data</span>.getOrNull(position)?.apply &#123; </span><br><span class="line">            update(<span class="keyword">this</span>).invoke(holder.vb)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; VB</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(item: <span class="type">T</span>)</span></span>: VB.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°æ€è·¯ä¹Ÿæ˜¯å’Œ Fragment ç±»ä¼¼çš„ï¼ŒAdapter çš„å­ç±»æ˜¯éœ€è¦æ˜¯å®ç° <code>createBinding</code> å°±å¯ä»¥å®ç°ç›¸åº”çš„é€»è¾‘ã€‚è¿™é‡Œä»…æä¾›ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›®å‰è¿™ä¸ªå°è£…è¿˜è§£å†³ä¸äº†å¤šå¸ƒå±€çš„é—®é¢˜ã€‚å¦‚æœéœ€è¦è§£å†³å¤šå¸ƒå±€çš„é—®é¢˜è¿˜éœ€è¦åŸºäº ViewHolder è¿›è¡Œå°è£…ï¼Œèªæ˜çš„ä½ èƒ½æƒ³å‡ºæ¥ä¹ˆï¼Ÿ</p>
<blockquote>
<p>æ¯ä¸ªé¡¹ç›®éƒ½æœ‰è‡ªå·±å°è£…çš„å…³äº Adapter ç±»ï¼Œè¿™è¾¹æä¾›çš„æ˜¯å°è£…æ€è·¯ä»…ä¸ºæŠ›ç –å¼•ç‰ã€‚è¿™é‡Œå¥‰ä¸Šæˆ‘<a href="https://gist.github.com/wenqin-231/70ee973b6d130e7e247360ee6d6021ad" target="_blank" rel="noopener">åŸºäº ViewHolder çš„å°è£…</a>ï¼Œæœ‰æ›´å¥½çš„æƒ³æ³•æ¬¢è¿ä¸æˆ‘è®¨è®º</p>
</blockquote>
<p>çœ‹å®Œäº†æˆ‘ä»¬ä¸Šé¢ä¸‰ä¸ªçš„å°è£…ï¼Œä½ ä¼šå‘ç°ï¼Œæˆ‘å°½é‡éƒ½æ˜¯è®© ViewBinding å»æ›¿æ¢æ‰æˆ‘åŸå…ˆä½¿ç”¨ <code>R.layout.xxx</code> çš„åœ°æ–¹ï¼Œè®©è°ƒç”¨æ–¹åªå…³å¿ƒ ViewBinding å°±å¯ä»¥å†™å¥½ä»£ç ã€‚ä¸å¥½çš„åœ°æ–¹å°±æ˜¯ lint æ£€æŸ¥çš„æ—¶å€™ä¼šå‘ç°æˆ‘æœ‰å¤§é‡çš„ xml æ²¡æœ‰ä½¿ç”¨ğŸ˜‚</p>
<h3 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h3><p>å‰é¢æ˜¯èŠäº†è¿™ä¹ˆä¹… ViewBinding çš„ä¼˜ç‚¹ï¼Œæˆ‘ä»¬å†æ¥è®²è®²å®ƒçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>è°ƒç”¨æ–¹å¼çš„ä¸å‹å¥½<ul>
<li>ä¸ <code>kotlin synthetics</code> ç›¸æ¯”ï¼Œwidget çš„å¼•ç”¨è¦ä¾èµ–äº binding çš„å®ä¾‹ï¼Œä½†å¯ä»¥ç”¨ apply æˆ–è€… run æ¥ç¼“è§£</li>
</ul>
</li>
<li>inlcude æ ‡ç­¾ä¸å‹å¥½<ul>
<li>ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼Œå³ä¾¿æˆ‘ä»¬ä¸ç»™ include åŠ  idï¼Œä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚è€Œ <code>Viewbinding</code> ä½ å¾—ä½¿ç”¨ <code>binding.inlcdeId.widgetId</code> æ¥è·å¾— widget çš„å¼•ç”¨ã€‚å¦‚æœ include é‡Œé¢è¿˜æœ‰ inlcude ï¼Œå°±åªèƒ½ä¸åœåœ°å¥—å¨ƒğŸ™„</li>
<li>inlcude å¦‚æœä½¿ç”¨äº† merge æ ‡ç­¾ï¼Œä½ è¿˜å¾— <code>MyInlcudeLayoutBinding.bind(binding.includeId)</code> æ¥ç»‘å®šï¼Œå¦åˆ™ä¼šæŠ¥é”™</li>
</ul>
</li>
<li>é‡å¤å‘½åä¸å‹å¥½<ul>
<li>å¦‚æœä¸€ä¸ª id çš„å‘½åå’Œ inlcude æˆ–è€…è‡ªå®šä¹‰ View å†…éƒ¨çš„å‘½åç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ª widget çš„å¼•ç”¨å°†ä¼šå¤±æ•ˆï¼Œè€Œä¸”ç¨‹åºä¸ä¼šå´©æºƒğŸ¤¦â€â™€ï¸ï¼Œè¿™ç§éšè—çš„é—®é¢˜åªæœ‰ç¨‹åºè¿è¡Œåˆ°é‚£é‡Œå¹¶ä¸”å‘ç° UI å¼‚å¸¸æ‰èƒ½è¢«å‘ç°ğŸ˜­</li>
</ul>
</li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¯¹æˆ‘æ¥è¯´ï¼Œ<code>ViewBinding</code> è¿˜æ˜¯è›®ç”œçš„ï¼Œç”±äºæ˜¯ Binding çš„å¼•ç”¨ï¼Œæ¯å¤„çš„è°ƒç”¨æˆ‘ä¼šç›¸å¯¹æ¯”è¾ƒæœ‰å®‰å…¨æ„Ÿï¼Œä¸ç”¨æ‹…å¿ƒä»£ç çš„å‡ºé”™ã€‚ç»è¿‡åŠå¹´çš„å®è·µå¼€å‘ï¼Œä¹Ÿæ²¡æœ‰é‡åˆ°æ¯”è¾ƒå¤§çš„å‘ï¼Œæ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ğŸ˜</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/03/10/å¤§å›¾åŠ è½½å™¨ TileView å®è·µæ¢ç´¢ï¼ˆä¸Šï¼‰/" class="next">NEXT</a></div><div class="copyright"><p>Â© 2017 - 2020 <a href="http://yoursite.com">æ–‡é’¦</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>