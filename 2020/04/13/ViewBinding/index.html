<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> å…³äº ViewBinding çš„äºŒä¸‰äº‹ Â· æ–‡é’¦çš„æœèŠ±å¤•æ‹¾</title><meta name="description" content="å…³äº ViewBinding çš„äºŒä¸‰äº‹ - æ–‡é’¦"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/lewis.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="æ–‡é’¦çš„æœèŠ±å¤•æ‹¾"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/lewis.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/wenqin-231" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://wenqin231@gmail.com" target="_blank" class="nav-list-link">EMAIL</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">å…³äº ViewBinding çš„äºŒä¸‰äº‹</h1><div class="post-info">Apr 13, 2020</div><div class="post-content"><p><img src="https://i.loli.net/2020/04/11/9vzHZi6IBTcgNtA.png" alt="ViewBinding.png"></p>
<p>éšç€ Android Studio 3.6 çš„å‘å¸ƒï¼Œ ViewBing ä¹Ÿè¿›å…¥äº†å¼€å‘è€…ä»¬çš„è§†é‡ã€‚å®˜æ–¹æ¨èä½¿ç”¨å®ƒæ¥æ›¿ä»£ <code>findVeiwById</code> ã€<code>BufferKnife</code> ä»¥åŠ <code>Kotlin Synthetics</code> ã€‚é‚£ä¹ˆå®ƒç©¶ç«Ÿæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œåˆæœ‰å“ªäº›ç¼ºé™·ï¼Œè®©æˆ‘ä»¬å±•å¼€è®²è®²ã€‚</p>
<a id="more"></a>
<h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><p>ç›¸æ¯”äºä¼ ç»Ÿçš„ <code>findViewById</code>ï¼Œ<code>ViewBinding</code> æœ€ç›´è§‚çš„ä¼˜åŠ¿æ˜¯å‡å°‘ä»£ç é‡ã€‚å¯¹äºè¿½æ±‚æ•ˆï¼ˆlanï¼‰ç‡ï¼ˆduoï¼‰çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™æ˜¯æœ€å¸å¼•äººçš„åœ°æ–¹ã€‚è™½ç„¶ ButterKnife ä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶åšåˆ°è¿™ç‚¹ï¼Œä½†æ˜¯é‚£äº› <code>@BindView</code> è¿˜æ˜¯å®æ‰“å®çš„å­˜åœ¨ä½ çš„ä»£ç ä¸­ï¼Œå¹¶ä¸”ä»¥åæ¯æ–°å¢ä¸€ä¸ª widgetï¼Œä½ éƒ½éœ€è¦è€ƒè™‘åœ¨ä»£ç é‡Œå£°æ˜æ–°çš„ç»‘å®šå…³ç³»ã€‚è€Œ ViewBinding æ˜¯åŠ¨æ€ç”Ÿæ•ˆçš„ï¼Œåœ¨ä½ çš„ XML æ·»åŠ å®Œæ–°çš„ widget åï¼ŒViewBinding æ–‡ä»¶å°±å¯ä»¥è°ƒç”¨å®ƒäº†ã€‚</p>
<p><img src="https://i.loli.net/2020/04/13/S17cR4a3olGwxVs.jpg" alt="happy.jpg"></p>
<p>æœ‰æœ‹å‹å¯èƒ½ä¼šè¯´äº†ï¼ŒKotlin Synthetics åŒæ ·ä¹Ÿå‡å°‘äº†å¾ˆå¤šä»£ç é‡å‘¢ï¼è·Ÿä½ è¿™ä¸ª ViewBinding æ¯”èµ·æ¥ï¼Œå®ƒä¸é¦™ä¹ˆï¼Ÿé‚£è¿™é‡Œå°±ä¸å¾—ä¸æåˆ° ViewBinding çš„ç¬¬äºŒä¸ªä¼˜åŠ¿äº†â€”â€”å®‰å…¨ã€‚</p>
<ul>
<li><strong>ç©ºå®‰å…¨</strong>ï¼šå› ä¸º ViewBinding ä¼šå¯¹æ ¹æ® XML æ–‡ä»¶ä¸­çš„ ID åˆ›å»ºä¸€ä¸ªå¯¹ widget çš„ç›´æ¥å¼•ç”¨ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ç©ºå¯¹è±¡çš„æƒ…å†µã€‚</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šå› ä¸º ViewBinding çš„å¼•ç”¨æ˜¯åŒ¹é… XML æ–‡ä»¶ä¸­çš„ç»„ä»¶ï¼Œå› æ­¤ä¹Ÿä¸å­˜åœ¨ç±»å‹é”™è¯¯çš„æƒ…å†µ</li>
</ul>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒKotlin Synthetics çš„å¼•ç”¨æ˜¯å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡ View æˆ–è€… Activity å¼•ç”¨åˆ°ä»»æ„ xml ä¸­çš„ widgetï¼Œåªè¦ import è¿›æ¥ã€‚å› ä¸ºï¼Œå¦‚æœæˆ‘ä»¬æœ‰ç›¸åŒçš„å‘½åçš„ widget å°±å¯ä»¥æœ‰å¼•ç”¨é”™è¯¯çš„æƒ…å†µï¼Œè¿™ä¼šå¼•å‘åº”ç”¨ Crashã€‚è€Œä¸”è¿™ç§å¼‚å¸¸åœ¨ç¼–è¯‘æœŸè¿˜æ²¡æ³•è¢«å‘ç°ï¼Œåªæœ‰ç¨‹åºè¿è¡Œåˆ°ä½¿ç”¨é”™è¯¯çš„åœ°æ–¹æ‰ä¼šå‡ºç°ï¼Œè¿™å°±ç»™åº”ç”¨ç•™ä¸‹äº†å®‰å…¨éšæ‚£ã€‚</p>
<p>è€Œ ViewBinding åˆ™ä¸å…·å¤‡è¿™æ ·çš„é—®é¢˜ï¼Œå®ƒä¿è¯äº†ä½ åªèƒ½è°ƒç”¨å¯¹åº” XML æ–‡ä»¶çš„ widgetï¼Œç›¸å¯¹æ¥è¯´æ›´åŠ å®‰å…¨ã€‚è€Œä¸”å®ƒå…¼å®¹ Javaï¼Œè¿™å¯¹äºè¿˜æœ‰éƒ¨åˆ†ä»£ç æ²¡è¿ç§»åˆ° Kotlin çš„ä»£ç æ¥è¯´ï¼Œä¹Ÿæ˜¯é‡å¤§åˆ©å¥½ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:center">ViewBinding</th>
<th style="text-align:center">ButterKnife</th>
<th style="text-align:center">Kotlin Synthetics</th>
<th style="text-align:center">findViewById</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç©ºå®‰å…¨</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">â›”ï¸</td>
</tr>
<tr>
<td style="text-align:left">ä¿è¯å¼•ç”¨æ˜¯<br>æ¥è‡ªå£°æ˜çš„ XML</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">â›”ï¸</td>
</tr>
<tr>
<td style="text-align:left">æ”¯æŒ Kotlin å’Œ Java</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">â›”ï¸</td>
<td style="text-align:center">âœ…</td>
</tr>
<tr>
<td style="text-align:left">ä»£ç é‡</td>
<td style="text-align:center">â¤ï¸</td>
<td style="text-align:center">ğŸ’”</td>
<td style="text-align:center">â¤ï¸</td>
<td style="text-align:center">ğŸ’”</td>
</tr>
</tbody>
</table>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>åœ¨ <code>build.gradle</code> ä¸­å£°æ˜ä½¿ç”¨ ViewBinding</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Android Studio 3.6</span></span><br><span class="line">android &#123;</span><br><span class="line">    viewBinding &#123;</span><br><span class="line">        enabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨ Android Stduio 4.0 ä¸­ï¼ŒViewBinding å·²ç»ç§»å…¥<code>buildFeatures</code> ä¸­äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Android Studio 4.0</span><br><span class="line">android &#123;</span><br><span class="line">    buildFeatures &#123;</span><br><span class="line">        viewBinding = true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å£°æ˜åï¼Œæ ¹æ®ä½ çš„ xml å‘½ååŠ¨æ€ç”Ÿæˆ **Bindingï¼Œä¾‹å¦‚ activity_home å°±ä¼šç”Ÿæˆ ActivityHomeBinding</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityHomeBinding</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    binding = ActivityHomeBinding.inflate(layoutInflater)</span><br><span class="line">    <span class="keyword">val</span> view = binding.root</span><br><span class="line">    setContentView(view)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ å·²ç» inflate äº† xmlï¼Œé‚£ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>bind(view)</code> å°† ViewBinding å’Œ view ç»‘å®šï¼Œè¿™ä¾¿äºæˆ‘ä»¬å¯¹è‡ªå®šä¹‰ View è¿›è¡Œé‡æ„ã€‚</p>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ä»å»å¹´å¹´åº•å¼€å§‹ï¼Œæˆ‘å°±åœ¨ Android Studio 3.6 preview ç‰ˆæœ¬ä¸Šä½¿ç”¨ ViewBinding å¼€å‘äº†ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹é¡¹ç›®å†…çš„å®è·µæ€è·¯ã€‚</p>
<h4 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h4><p>æœ€ç»å¸¸ä½¿ç”¨çš„ Fragmentï¼Œæˆ‘åˆ›å»ºäº† BindingFragment</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingFragment</span>&lt;<span class="type">T : ViewBinding</span>&gt; : <span class="type">BaseFragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        initData().invoke(arguments ?: Bundle())</span><br><span class="line">        binding = createBinding().invoke(inflater, container, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">        setupView().invoke(binding)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">initData</span><span class="params">()</span></span>: Bundle.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setupView</span><span class="params">()</span></span>: T.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">ctx</span><span class="params">()</span></span>: Context = binding.root.context</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å­ç±»ä½¿ç”¨</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeFragment</span> : <span class="type">BindingFragment</span>&lt;<span class="type">FragmentHomeBinding</span>&gt;</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; FragmentHomeBinding &#123;</span><br><span class="line">        <span class="keyword">return</span> FragmentHomeBinding::inflate</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setupView</span><span class="params">()</span></span>: FragmentHomeBinding.() -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">        tvContent.text = <span class="string">"ViewBinding is cool"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå­ç±»ï¼Œæˆ‘åªéœ€è¦å…³å¿ƒ <code>fragment_home.xml</code> ç”Ÿæˆçš„ <code>FragmentHomeBinding</code>ï¼Œä¸éœ€è¦é¢å¤–å¯¹ <code>R.layout.fragment_home</code> è¿›è¡Œå¤„ç†ã€‚åœ¨ <code>setupView</code> ä¸­æˆ‘å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>tvContent</code>  çš„å¼•ç”¨ï¼Œå°±åƒåœ¨ä½¿ç”¨ <code>kotlin Synthetics</code> ä¸€æ ·ã€‚</p>
<h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>è‡ªå®šä¹‰ View ä¹Ÿæ˜¯ç»å¸¸ä½¿ç”¨çš„ï¼Œè¿™é‡Œæœ‰ä¸¤ç§ä½¿ç”¨æ€è·¯</p>
<p>å…ˆç”¨ View#inflate ç»‘å®š XML åï¼Œå†ç”¨ ViewBinding#bind ç»‘å®š Viewï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ ViewBinding æ¥æ¸²æŸ“ç›¸åº”çš„ UIï¼Œè¿™ç§æ–¹å¼æ–¹ä¾¿æˆ‘ä»¬é‡æ„å·²ç»å†™å¥½çš„ Viewï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyView</span> <span class="meta">@JvmOverloads</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, attrs: AttributeSet? = <span class="literal">null</span>, defStyleAttr: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">) : ConstraintLayout(context, attrs, defStyleAttr) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding: ViewEmptyBinding</span><br><span class="line">    </span><br><span class="line">    init &#123;</span><br><span class="line">        View.inflate(context, R.layout.view_empty, <span class="keyword">this</span>)</span><br><span class="line">        binding = ViewEmptyBinding.bind(<span class="keyword">this</span>)</span><br><span class="line">        binding.apply &#123;</span><br><span class="line">            tvTitle.text = <span class="string">"Data is emtpy"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ç§æ˜¯ä½¿ç”¨ ViewBinding#inflateï¼Œè¿™ç§å°±ä¸ç”¨å…³å¿ƒ <code>R.layout.view_emty</code>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyView</span> <span class="meta">@JvmOverloads</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, attrs: AttributeSet? = <span class="literal">null</span>, defStyleAttr: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">) : ConstraintLayout(context, attrs, defStyleAttr) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding = ViewEmptyBinding.inflate(LayoutInflater.from(context), <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        binding.apply &#123;</span><br><span class="line">            tvTitle.text = <span class="string">"Data is emtpy"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h4><p>é¡¹ç›®é‡Œçš„ Adapter æ˜¯åŸºäºç¬¬ä¸‰æ–¹åº“è¿›è¡Œå°è£…çš„ï¼Œè¿™é‡Œæä¾›ä¸€ç§åŸºäº RecyclerView#Adapter çš„å°è£…ä½œä¸ºå‚è€ƒï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingViewHolder</span>&lt;<span class="type">VB : ViewBinding</span>&gt;</span>(<span class="keyword">val</span> vb: VB) : RecyclerView.ViewHolder(vb.root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingAdapter</span>&lt;<span class="type">VB : ViewBinding, T</span>&gt; : <span class="type">RecyclerView.Adapter</span>&lt;<span class="type">BindingViewHolder&lt;VB</span>&gt;&gt;</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">data</span>: MutableList&lt;T&gt; = arrayListOf()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateViewHolder</span><span class="params">(parent: <span class="type">ViewGroup</span>, viewType: <span class="type">Int</span>)</span></span>: BindingViewHolder&lt;VB&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingViewHolder(</span><br><span class="line">            createBinding().invoke(LayoutInflater.from(parent.context), parent, <span class="literal">false</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> = <span class="keyword">data</span>.size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">BindingViewHolder</span>&lt;<span class="type">VB</span>&gt;, position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">data</span>.getOrNull(position)?.apply &#123; </span><br><span class="line">            update(<span class="keyword">this</span>).invoke(holder.vb)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; VB</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(item: <span class="type">T</span>)</span></span>: VB.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°æ€è·¯ä¹Ÿæ˜¯å’Œ Fragment ç±»ä¼¼çš„ï¼ŒAdapter çš„å­ç±»æ˜¯éœ€è¦æ˜¯å®ç° createBinding å°±å¯ä»¥å®ç°ç›¸åº”çš„é€»è¾‘ã€‚è¿™é‡Œä»…æä¾›ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›®å‰è¿™ä¸ªå°è£…è¿˜è§£å†³ä¸äº†å¤šå¸ƒå±€çš„é—®é¢˜ã€‚å¦‚æœéœ€è¦è§£å†³å¤šå¸ƒå±€çš„é—®é¢˜è¿˜éœ€è¦åŸºäº ViewHolder è¿›è¡Œå°è£…ï¼Œèªæ˜çš„ä½ èƒ½æƒ³å‡ºæ¥ä¹ˆï¼Ÿ</p>
<p>çœ‹å®Œäº†æˆ‘ä»¬ä¸Šé¢ä¸‰ä¸ªçš„å°è£…ï¼Œä½ ä¼šå‘ç°ï¼Œæˆ‘å°½é‡éƒ½æ˜¯è®© ViewBinding å»æ›¿æ¢æ‰æˆ‘åŸå…ˆä½¿ç”¨ <code>R.layout.xxx</code> çš„åœ°æ–¹ã€‚å°½é‡ç”¨ ViewBinding æ¥æ›¿æ¢ xml çš„è°ƒç”¨ï¼Œè®©è°ƒç”¨æ–¹åªå…³å¿ƒ ViewBinding å°±å¯ä»¥å†™å¥½ä»£ç ã€‚ä¸å¥½å°±æ˜¯ lint æ£€æŸ¥çš„æ—¶å€™ä¼šå‘ç°æˆ‘æœ‰å¤§é‡çš„ xml æ²¡æœ‰ä½¿ç”¨ğŸ˜‚</p>
<h3 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h3><p>å‰é¢æ˜¯èŠäº†è¿™ä¹ˆä¹… ViewBinding çš„ä¼˜ç‚¹ï¼Œæˆ‘ä»¬å†æ¥è®²è®²å®ƒçš„ç¼ºç‚¹ï¼š</p>
<p>é¦–å…ˆæ˜¯è°ƒç”¨æ–¹å¼çš„ä¸å‹å¥½ã€‚ä»–çš„å¼•ç”¨ä¾èµ–äº binding çš„å®åŠ›ï¼Œè¿™ç‚¹ä½¿ç”¨ apply æˆ– run æœ‰æ‰€ç¼“è§£</p>
<p>å…¶æ¬¡å°±æ˜¯å¯¹ include æ ‡ç­¾çš„ä¸å‹å¥½ã€‚åœ¨å…¶ä»–çš„ä½¿ç”¨ä¸­ï¼Œå³ä¾¿æˆ‘ä»¬ä¸ç»™ inlcude åŠ æ ‡ç­¾ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚è€Œä½¿ç”¨äº† Viewbindingï¼Œå¯¹äº include ä½ åªèƒ½ binding.inlcudeId.widgetIdï¼Œ å¦‚æœ inlcude é‡Œé¢è¿˜æœ‰ inlcude ï¼Œå°±åªèƒ½ä¸åœåœ°å¥—å¨ƒï¼›å†è€…ï¼Œå¦‚æœ inlcude ä½¿ç”¨äº† merge çš„æ ‡ç­¾ï¼Œä½ è¿˜éœ€è¦ä½¿ç”¨ InlcudeBinding.bind(bingding.includeId) æ¥è¿›è¡Œç»‘å®šï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™</p>
<p>æœ€åæ˜¯é‡å¤å‘½åçš„ä¸å‹å¥½ã€‚å¦‚æœå¤–éƒ¨ä¸å°å¿ƒè°ƒåŠ¨äº†å’Œ include å†…éƒ¨æˆ–è€…è‡ªå®šä¹‰ View å†…éƒ¨ä¸€æ ·çš„ idï¼Œé‚£ä¹ˆè¿™ä¸ª widget çš„å¼•ç”¨å°†ä¼šå¤±æ•ˆï¼Œè€Œä¸”ç¨‹åºä¸ä¼šå´©æºƒã€‚è¿™ç§éšè—çš„é—®é¢˜åªæœ‰ç¨‹åºè¿è¡Œåˆ°é‚£é‡Œå¹¶ä¸”å‘ç° UI å¼‚å¸¸æ‰èƒ½è¢«å‘ç°ï¼Œå¸Œæœ› Google ä¹‹åèƒ½ä¿®å¤è¿™ä¸ªé—®é¢˜</p>
<p>###æ€»ç»“</p>
<p>å¯¹æˆ‘æ¥è¯´ï¼ŒViewBinding è¿˜æ˜¯è›®ç”œçš„ï¼Œç”±äºæ˜¯ Binding çš„å¼•ç”¨ï¼Œæ¯å¤„çš„è°ƒç”¨æˆ‘ä¼šç›¸å¯¹æ¯”è¾ƒæœ‰å®‰å…¨æ„Ÿï¼Œä¸ç”¨æ‹…å¿ƒä»£ç çš„å‡ºé”™ã€‚ä½¿ç”¨ Binding å¯¹è±¡æ„Ÿè§‰ä¹Ÿæ¯”è¾ƒå®‰å…¨ã€‚æ¨èä½ ä½¿ç”¨ ViewBinding æ¥è°ƒç”¨ä½ çš„ widgetã€‚</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/03/10/å¤§å›¾åŠ è½½å™¨ TileView å®è·µæ¢ç´¢ï¼ˆä¸Šï¼‰/" class="next">ä¸‹ä¸€ç¯‡</a></div><div class="copyright"><p>Â© 2017 - 2020 <a href="http://yoursite.com">æ–‡é’¦</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>