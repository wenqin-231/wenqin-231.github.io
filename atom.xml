<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ–‡é’¦çš„æœèŠ±å¤•æ‹¾</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-04-15T12:58:08.223Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>æ–‡é’¦</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å…³äº ViewBinding çš„äºŒä¸‰äº‹</title>
    <link href="http://yoursite.com/2020/04/13/ViewBinding/"/>
    <id>http://yoursite.com/2020/04/13/ViewBinding/</id>
    <published>2020-04-13T12:42:38.207Z</published>
    <updated>2020-04-15T12:58:08.223Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2020/04/11/9vzHZi6IBTcgNtA.png" alt="ViewBinding.png"></p><p><strong>ViewBinding</strong> æ˜¯ Android Studio 3.6 æ¨å‡ºçš„æ–°å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è½»æ¾é«˜æ•ˆåœ°ç¼–å†™ä¸ View äº¤äº’çš„ä»£ç ã€‚åœ¨å¯ç”¨åï¼Œæ ¹æ® XML å¸ƒå±€æ–‡ä»¶ä¼šç”Ÿæˆå¯¹åº”çš„ binding ç±»ï¼Œè¿™ä¸ªç±»åŒ…å«äº†å¸ƒå±€å†…æ‰€æœ‰è®¾ç½®è¿‡ id çš„ View çš„å¼•ç”¨ã€‚</p><p>å®˜æ–¹æ¨èä½¿ç”¨å®ƒæ¥æ›¿ä»£ <code>findVeiwById</code> ï¼›<a href="https://twitter.com/JakeWharton" target="_blank" rel="noopener">Jake Wharton</a> ä¹Ÿåœ¨ç¤¾äº¤å¹³å°ä¸Šæ¨èå®ƒæ›¿æ¢ <code>ButterKnife</code>ï¼›åœ¨ kotlinä¸­å¸¸ç”¨çš„ <code>Kotlin Synthetics</code> åˆæœ‰ä»€ä¹ˆæ¯”ä¸ä¸Šå®ƒçš„å‘¢ï¼Ÿå®ƒæœ¬èº«ä¼šä¸ä¼šæœ‰ä»€ä¹ˆå‘ï¼Ÿè®©æˆ‘ä»¬å±•å¼€è®²è®²ã€‚</p><a id="more"></a><h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><p>ç›¸æ¯”äºä¼ ç»Ÿçš„ <code>findViewById</code>ï¼Œ<code>ViewBinding</code> æœ€ç›´è§‚çš„ä¼˜åŠ¿æ˜¯å‡å°‘ä»£ç é‡ã€‚å¯¹äºè¿½æ±‚æ•ˆï¼ˆlanï¼‰ç‡ï¼ˆduoï¼‰çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™æ˜¯æœ€å¸å¼•äººçš„åœ°æ–¹ã€‚</p><p>è™½ç„¶ <code>ButterKnife</code> ä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶åšåˆ°è¿™ç‚¹ï¼Œä½†æ˜¯é‚£äº› <code>@BindView</code> è¿˜æ˜¯å®æ‰“å®åœ°å­˜åœ¨ä½ çš„ä»£ç ä¸­ï¼Œå¹¶ä¸”ä»¥åæ¯å¢å‡ä¸€ä¸ª widgetï¼Œä½ éƒ½éœ€è¦è€ƒè™‘é‚£äº›ç»‘å®šå…³ç³»ã€‚è€Œ <code>ViewBinding</code> æ˜¯åŠ¨æ€ç”Ÿæ•ˆçš„ï¼Œåœ¨ä½ çš„ XML å¸ƒå±€æ–‡ä»¶æ·»åŠ å®Œæ–°çš„ widget åï¼Œ<code>ViewBinding</code> ç±»å°±å¯ä»¥è°ƒç”¨å®ƒäº†ğŸ˜</p><p><img src="https://i.loli.net/2020/04/13/S17cR4a3olGwxVs.jpg" alt="happy.jpg"></p><p>æœ‰æœ‹å‹å¯èƒ½ä¼šè¯´äº†ï¼Œ<code>Kotlin Synthetics</code> åŒæ ·ä¹Ÿå‡å°‘äº†å¾ˆå¤šä»£ç é‡å‘¢ï¼è·Ÿä½ è¿™ä¸ª <code>ViewBinding</code> æ¯”èµ·æ¥ï¼Œå®ƒä¸é¦™ä¹ˆï¼Ÿé‚£è¿™é‡Œå°±ä¸å¾—ä¸æåˆ° <code>ViewBinding</code> çš„ç¬¬äºŒä¸ªä¼˜åŠ¿äº†â€”â€”å®‰å…¨ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>Kotlin Synthetics</code> æ˜¯å¯ä»¥é€šè¿‡ View æˆ–è€… Activity å¼•ç”¨åˆ°ä»»æ„ XML ä¸­çš„ widgetï¼Œå¦‚æœä¸å°å¿ƒå¼•ç”¨é”™å°±ä¼šå¯¼è‡´åº”ç”¨ crashã€‚è€Œä¸”è¿™ç§å¼‚å¸¸åœ¨ç¼–è¯‘æœŸè¿˜æ²¡æ³•è¢«å‘ç°ï¼Œåªæœ‰ç¨‹åºè¿è¡Œåˆ°ä½¿ç”¨é”™è¯¯çš„åœ°æ–¹æ‰ä¼šå‡ºç°ï¼Œè¿™å°±ç»™åº”ç”¨ç•™ä¸‹äº†å®‰å…¨éšæ‚£âš ï¸</p><p>è€Œ ViewBinding åˆ™ä¸å…·å¤‡è¿™æ ·çš„é—®é¢˜ï¼Œå®ƒä¿è¯äº†ä½ åªèƒ½è°ƒç”¨å¯¹åº” XML å¸ƒå±€æ–‡ä»¶çš„ widgetï¼Œç›¸å¯¹æ¥è¯´æ›´å®‰å…¨ã€‚è€Œä¸”å®ƒå…¼å®¹ Javaï¼Œè¿™å¯¹äºè¿˜æœ‰éƒ¨åˆ†ä»£ç æ²¡è¿ç§»åˆ° Kotlin çš„ä»£ç æ¥è¯´ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒå‹å¥½çš„ã€‚</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:center">ViewBinding</th><th style="text-align:center">ButterKnife</th><th style="text-align:center">Kotlin Synthetics</th><th style="text-align:center">findViewById</th></tr></thead><tbody><tr><td style="text-align:left">ç©ºå®‰å…¨</td><td style="text-align:center">âœ…</td><td style="text-align:center">âœ…</td><td style="text-align:center">â›”ï¸</td><td style="text-align:center">â›”ï¸</td></tr><tr><td style="text-align:left">ä¿è¯å¼•ç”¨æ˜¯æ¥è‡ª<br>XML å¸ƒå±€æ–‡ä»¶</td><td style="text-align:center">âœ…</td><td style="text-align:center">â›”ï¸</td><td style="text-align:center">â›”ï¸</td><td style="text-align:center">â›”ï¸</td></tr><tr><td style="text-align:left">æ”¯æŒ Kotlin å’Œ Java</td><td style="text-align:center">âœ…</td><td style="text-align:center">âœ…</td><td style="text-align:center">â›”ï¸</td><td style="text-align:center">âœ…</td></tr><tr><td style="text-align:left">ä»£ç é‡</td><td style="text-align:center">â¤ï¸</td><td style="text-align:center">ğŸ’”</td><td style="text-align:center">â¤ï¸</td><td style="text-align:center">ğŸ’”</td></tr></tbody></table><blockquote><p>å°½ç®¡ ButterKnife æœ‰ä¿æŠ¤ View çš„ç©ºå®‰å…¨ï¼Œä½†æ˜¯å®ƒä¸èƒ½ä¿è¯ id æ˜¯ä¸æ˜¯æ¥è‡ªäºå£°æ˜çš„ xml</p></blockquote><p>é‚£åˆæœ‰æœ‹å‹ä¼šé—®ï¼Œä½ è¿™ä¸ªæ˜¯ä¸æ˜¯è·Ÿ <code>DataBinding</code> ä¸€æ ·å‘€ï¼æˆ‘ç”¨äº† <code>DataBinding</code> æ˜¯ä¸æ˜¯å°±ä¸éœ€è¦å®ƒäº†å‘€ï¼Ÿ</p><p>è™½ç„¶ä»–ä»¬ä¸¤è€…éƒ½æ˜¯ç”Ÿæˆ Binding ç±»ï¼Œä½†æ˜¯ <code>ViewBinding</code> æ›´å€¾å‘äºåœ¨ç®€å•çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œ å› æ­¤å®ƒç›¸å¯¹äº <code>DataBinding</code>  æ¥è¯´ï¼š</p><ul><li>æ— éœ€æ³¨è§£ï¼Œç¼–è¯‘æ—¶é—´æ›´å¿«</li><li>ä½¿ç”¨æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å¯¹ XML å¸ƒå±€æ–‡ä»¶è¿›è¡Œç‰¹æ®Šæ ‡å¿—ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®é‡Œå¯åŠ¨å®ƒéå¸¸æ–¹ä¾¿</li></ul><p>å½“ç„¶ï¼Œæ¯”èµ· <code>DataBinding</code> å®ƒä¹Ÿæœ‰äº›é™åˆ¶ï¼š</p><ul><li>ä¸æ”¯æŒå¸ƒå±€å˜é‡å’Œå¸ƒå±€è¡¨è¾¾å¼ï¼Œæ‰€ä»¥å®ƒä¸èƒ½ä» XML å¸ƒå±€æ–‡ä»¶ä¸­è·å–æ•°æ®åŠ¨æ€æ›´æ–° UI</li><li>ä¸æ”¯æŒåŒå‘æ•°æ®ç»‘å®š</li></ul><p>å› æ­¤ï¼Œä½ å¯ä»¥åŒæ—¶æ”¯æŒ <code>ViewBinding</code> å’Œ <code>DataBinding</code>ã€‚å¦‚æœéœ€è¦é¢å¤–çš„ç‰¹æ€§ï¼Œä½ å¯ä»¥è®© <code>DataBinding</code> æ¥å®Œæˆï¼Œè€Œç®€å•çš„åº”ç”¨å°±äº¤ç»™ <code>ViewBinding</code></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>åœ¨ <code>build.gradle</code> ä¸­å£°æ˜ä½¿ç”¨ <code>ViewBinding</code></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Android Studio 3.6</span></span><br><span class="line">android &#123;</span><br><span class="line">    viewBinding &#123;</span><br><span class="line">        enabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ Android Stduio 4.0 ä¸­ï¼Œ<code>ViewBinding</code> å·²ç»ç§»å…¥<code>buildFeatures</code> ä¸­äº†</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Android Studio 4.0</span></span><br><span class="line">android &#123;</span><br><span class="line">    buildFeatures &#123;</span><br><span class="line">        viewBinding = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å£°æ˜åï¼Œæ ¹æ®ä½ çš„ xml å‘½ååŠ¨æ€ç”Ÿæˆ **Bindingï¼Œä¾‹å¦‚ activity_home å°±ä¼šç”Ÿæˆ ActivityHomeBinding</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityHomeBinding</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    binding = ActivityHomeBinding.inflate(layoutInflater)</span><br><span class="line">    <span class="keyword">val</span> view = binding.root</span><br><span class="line">    setContentView(view)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å·²ç» inflate äº† xmlï¼Œé‚£ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>bind(view)</code> å°† <code>ViewBinding</code> å’Œ View ç»‘å®šï¼Œè¿™ä¾¿äºæˆ‘ä»¬å¯¹è‡ªå®šä¹‰ View è¿›è¡Œé‡æ„ã€‚</p><h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p>ä»å»å¹´å¹´åº•å¼€å§‹ï¼Œæˆ‘å°±åœ¨ Android Studio 3.6 preview ç‰ˆæœ¬ä¸Šä½¿ç”¨ <code>ViewBinding</code> å¼€å‘äº†ã€‚ä¸‹é¢åˆ†äº«ä¸€ä¸‹é¡¹ç›®å†…çš„å®è·µæ€è·¯ã€‚</p><h4 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h4><p>æœ€ç»å¸¸ä½¿ç”¨çš„ Fragmentï¼Œæˆ‘åˆ›å»ºäº† BindingFragmentï¼Œç»§æ‰¿äºé¡¹ç›®é‡ŒåŸæ¥çš„ <code>BaseFragment</code>ï¼Œè®© Binding çš„ä¸šåŠ¡å°½é‡ä¸å½±å“åŸæ¥çš„å°è£…ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingFragment</span>&lt;<span class="type">T : ViewBinding</span>&gt; : <span class="type">BaseFragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        initData().invoke(arguments ?: Bundle())</span><br><span class="line">        binding = createBinding().invoke(inflater, container, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">        setupView().invoke(binding)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">initData</span><span class="params">()</span></span>: Bundle.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">setupView</span><span class="params">()</span></span>: T.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">ctx</span><span class="params">()</span></span>: Context = binding.root.context</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­ç±»ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeFragment</span> : <span class="type">BindingFragment</span>&lt;<span class="type">FragmentHomeBinding</span>&gt;</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; FragmentHomeBinding &#123;</span><br><span class="line">        <span class="keyword">return</span> FragmentHomeBinding::inflate</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setupView</span><span class="params">()</span></span>: FragmentHomeBinding.() -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">        tvContent.text = <span class="string">"ViewBinding is cool"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå­ç±»ï¼Œæˆ‘åªéœ€è¦å…³å¿ƒ <code>fragment_home.xml</code> ç”Ÿæˆçš„ <code>FragmentHomeBinding</code>ï¼Œä¸éœ€è¦é¢å¤–å¯¹ <code>R.layout.fragment_home</code> è¿›è¡Œå¤„ç†ã€‚åœ¨ <code>setupView</code> ä¸­æˆ‘å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>tvContent</code>  çš„å¼•ç”¨ï¼Œå°±åƒåœ¨ä½¿ç”¨ <code>kotlin Synthetics</code> ä¸€æ ·ã€‚</p><h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>è‡ªå®šä¹‰ View ä¹Ÿæ˜¯ç»å¸¸ä½¿ç”¨çš„ï¼Œè¿™é‡Œæœ‰ä¸¤ç§ä½¿ç”¨æ€è·¯</p><p>å…ˆç”¨ <code>View#inflate</code> ç»‘å®š XML åï¼Œå†ç”¨ <code>ViewBinding#bind</code> ç»‘å®š Viewï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ <code>ViewBinding</code> æ¥æ¸²æŸ“ç›¸åº”çš„ UIï¼Œè¿™ç§æ–¹å¼æ–¹ä¾¿æˆ‘ä»¬é‡æ„å·²ç»å†™å¥½çš„ Viewï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyView</span> <span class="meta">@JvmOverloads</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, attrs: AttributeSet? = <span class="literal">null</span>, defStyleAttr: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">) : ConstraintLayout(context, attrs, defStyleAttr) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding: ViewEmptyBinding</span><br><span class="line">    </span><br><span class="line">    init &#123;</span><br><span class="line">        View.inflate(context, R.layout.view_empty, <span class="keyword">this</span>)</span><br><span class="line">        binding = ViewEmptyBinding.bind(<span class="keyword">this</span>)</span><br><span class="line">        binding.apply &#123;</span><br><span class="line">            tvTitle.text = <span class="string">"Data is emtpy"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ˜¯ä½¿ç”¨ <code>ViewBinding#inflate</code>ï¼Œè¿™ç§å°±ä¸ç”¨å…³å¿ƒ <code>R.layout.view_emty</code>ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyView</span> <span class="meta">@JvmOverloads</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, attrs: AttributeSet? = <span class="literal">null</span>, defStyleAttr: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">) : ConstraintLayout(context, attrs, defStyleAttr) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding = ViewEmptyBinding.inflate(LayoutInflater.from(context), <span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        binding.apply &#123;</span><br><span class="line">            tvTitle.text = <span class="string">"Data is emtpy"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h4><p>é¡¹ç›®é‡Œçš„ Adapter æ˜¯åŸºäºç¬¬ä¸‰æ–¹åº“è¿›è¡Œå°è£…çš„ï¼Œè¿™é‡Œæä¾›ä¸€ç§åŸºäº <code>RecyclerView.Adapter</code> çš„å°è£…ä½œä¸ºå‚è€ƒï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingViewHolder</span>&lt;<span class="type">VB : ViewBinding</span>&gt;</span>(<span class="keyword">val</span> vb: VB) : RecyclerView.ViewHolder(vb.root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BindingAdapter</span>&lt;<span class="type">VB : ViewBinding, T</span>&gt; : <span class="type">RecyclerView.Adapter</span>&lt;<span class="type">BindingViewHolder&lt;VB</span>&gt;&gt;</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">data</span>: MutableList&lt;T&gt; = arrayListOf()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateViewHolder</span><span class="params">(parent: <span class="type">ViewGroup</span>, viewType: <span class="type">Int</span>)</span></span>: BindingViewHolder&lt;VB&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingViewHolder(</span><br><span class="line">            createBinding().invoke(LayoutInflater.from(parent.context), parent, <span class="literal">false</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> = <span class="keyword">data</span>.size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">BindingViewHolder</span>&lt;<span class="type">VB</span>&gt;, position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">data</span>.getOrNull(position)?.apply &#123; </span><br><span class="line">            update(<span class="keyword">this</span>).invoke(holder.vb)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createBinding</span><span class="params">()</span></span>: (</span><br><span class="line">        inflater: LayoutInflater,</span><br><span class="line">        container: ViewGroup?,</span><br><span class="line">        attachToRoot: <span class="built_in">Boolean</span></span><br><span class="line">    ) -&gt; VB</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(item: <span class="type">T</span>)</span></span>: VB.() -&gt; <span class="built_in">Unit</span> = &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°æ€è·¯ä¹Ÿæ˜¯å’Œ Fragment ç±»ä¼¼çš„ï¼ŒAdapter çš„å­ç±»æ˜¯éœ€è¦æ˜¯å®ç° <code>createBinding</code> å°±å¯ä»¥å®ç°ç›¸åº”çš„é€»è¾‘ã€‚è¿™é‡Œä»…æä¾›ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›®å‰è¿™ä¸ªå°è£…è¿˜è§£å†³ä¸äº†å¤šå¸ƒå±€çš„é—®é¢˜ã€‚å¦‚æœéœ€è¦è§£å†³å¤šå¸ƒå±€çš„é—®é¢˜è¿˜éœ€è¦åŸºäº ViewHolder è¿›è¡Œå°è£…ï¼Œèªæ˜çš„ä½ èƒ½æƒ³å‡ºæ¥ä¹ˆï¼Ÿ</p><blockquote><p>æ¯ä¸ªé¡¹ç›®éƒ½æœ‰è‡ªå·±å°è£…çš„å…³äº Adapter ç±»ï¼Œè¿™è¾¹æä¾›çš„æ˜¯å°è£…æ€è·¯ä»…ä¸ºæŠ›ç –å¼•ç‰ã€‚è¿™é‡Œå¥‰ä¸Šæˆ‘<a href="https://gist.github.com/wenqin-231/70ee973b6d130e7e247360ee6d6021ad" target="_blank" rel="noopener">åŸºäº ViewHolder çš„å°è£…</a>ï¼Œæœ‰æ›´å¥½çš„æƒ³æ³•æ¬¢è¿ä¸æˆ‘è®¨è®º</p></blockquote><p>çœ‹å®Œäº†æˆ‘ä»¬ä¸Šé¢ä¸‰ä¸ªçš„å°è£…ï¼Œä½ ä¼šå‘ç°ï¼Œæˆ‘å°½é‡éƒ½æ˜¯è®© ViewBinding å»æ›¿æ¢æ‰æˆ‘åŸå…ˆä½¿ç”¨ <code>R.layout.xxx</code> çš„åœ°æ–¹ï¼Œè®©è°ƒç”¨æ–¹åªå…³å¿ƒ ViewBinding å°±å¯ä»¥å†™å¥½ä»£ç ã€‚ä¸å¥½çš„åœ°æ–¹å°±æ˜¯ lint æ£€æŸ¥çš„æ—¶å€™ä¼šå‘ç°æˆ‘æœ‰å¤§é‡çš„ xml æ²¡æœ‰ä½¿ç”¨ğŸ˜‚</p><h3 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h3><p>å‰é¢æ˜¯èŠäº†è¿™ä¹ˆä¹… ViewBinding çš„ä¼˜ç‚¹ï¼Œæˆ‘ä»¬å†æ¥è®²è®²å®ƒçš„ç¼ºç‚¹ï¼š</p><ul><li>è°ƒç”¨æ–¹å¼çš„ä¸å‹å¥½<ul><li>ä¸ <code>kotlin synthetics</code> ç›¸æ¯”ï¼Œwidget çš„å¼•ç”¨è¦ä¾èµ–äº binding çš„å®ä¾‹ï¼Œä½†å¯ä»¥ç”¨ apply æˆ–è€… run æ¥ç¼“è§£</li></ul></li><li>inlcude æ ‡ç­¾ä¸å‹å¥½<ul><li>ä½¿ç”¨å…¶ä»–æ–¹å¼ï¼Œå³ä¾¿æˆ‘ä»¬ä¸ç»™ include åŠ  idï¼Œä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚è€Œ <code>Viewbinding</code> ä½ å¾—ä½¿ç”¨ <code>binding.inlcdeId.widgetId</code> æ¥è·å¾— widget çš„å¼•ç”¨ã€‚å¦‚æœ include é‡Œé¢è¿˜æœ‰ inlcude ï¼Œå°±åªèƒ½ä¸åœåœ°å¥—å¨ƒğŸ™„</li><li>inlcude å¦‚æœä½¿ç”¨äº† merge æ ‡ç­¾ï¼Œä½ è¿˜å¾— <code>MyInlcudeLayoutBinding.bind(binding.includeId)</code> æ¥ç»‘å®šï¼Œå¦åˆ™ä¼šæŠ¥é”™</li></ul></li><li>é‡å¤å‘½åä¸å‹å¥½<ul><li>å¦‚æœä¸€ä¸ª id çš„å‘½åå’Œ inlcude æˆ–è€…è‡ªå®šä¹‰ View å†…éƒ¨çš„å‘½åç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ª widget çš„å¼•ç”¨å°†ä¼šå¤±æ•ˆï¼Œè€Œä¸”ç¨‹åºä¸ä¼šå´©æºƒğŸ¤¦â€â™€ï¸ï¼Œè¿™ç§éšè—çš„é—®é¢˜åªæœ‰ç¨‹åºè¿è¡Œåˆ°é‚£é‡Œå¹¶ä¸”å‘ç° UI å¼‚å¸¸æ‰èƒ½è¢«å‘ç°ğŸ˜­</li></ul></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¯¹æˆ‘æ¥è¯´ï¼Œ<code>ViewBinding</code> è¿˜æ˜¯è›®ç”œçš„ï¼Œç”±äºæ˜¯ Binding çš„å¼•ç”¨ï¼Œæ¯å¤„çš„è°ƒç”¨æˆ‘ä¼šç›¸å¯¹æ¯”è¾ƒæœ‰å®‰å…¨æ„Ÿï¼Œä¸ç”¨æ‹…å¿ƒä»£ç çš„å‡ºé”™ã€‚ç»è¿‡åŠå¹´çš„å®è·µå¼€å‘ï¼Œä¹Ÿæ²¡æœ‰é‡åˆ°æ¯”è¾ƒå¤§çš„å‘ï¼Œæ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/04/11/9vzHZi6IBTcgNtA.png&quot; alt=&quot;ViewBinding.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ViewBinding&lt;/strong&gt; æ˜¯ Android Studio 3.6 æ¨å‡ºçš„æ–°å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è½»æ¾é«˜æ•ˆåœ°ç¼–å†™ä¸ View äº¤äº’çš„ä»£ç ã€‚åœ¨å¯ç”¨åï¼Œæ ¹æ® XML å¸ƒå±€æ–‡ä»¶ä¼šç”Ÿæˆå¯¹åº”çš„ binding ç±»ï¼Œè¿™ä¸ªç±»åŒ…å«äº†å¸ƒå±€å†…æ‰€æœ‰è®¾ç½®è¿‡ id çš„ View çš„å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹æ¨èä½¿ç”¨å®ƒæ¥æ›¿ä»£ &lt;code&gt;findVeiwById&lt;/code&gt; ï¼›&lt;a href=&quot;https://twitter.com/JakeWharton&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Jake Wharton&lt;/a&gt; ä¹Ÿåœ¨ç¤¾äº¤å¹³å°ä¸Šæ¨èå®ƒæ›¿æ¢ &lt;code&gt;ButterKnife&lt;/code&gt;ï¼›åœ¨ kotlinä¸­å¸¸ç”¨çš„ &lt;code&gt;Kotlin Synthetics&lt;/code&gt; åˆæœ‰ä»€ä¹ˆæ¯”ä¸ä¸Šå®ƒçš„å‘¢ï¼Ÿå®ƒæœ¬èº«ä¼šä¸ä¼šæœ‰ä»€ä¹ˆå‘ï¼Ÿè®©æˆ‘ä»¬å±•å¼€è®²è®²ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¤§å›¾åŠ è½½å™¨ TileView å®è·µæ¢ç´¢ï¼ˆä¸Šï¼‰</title>
    <link href="http://yoursite.com/2019/03/10/%E5%A4%A7%E5%9B%BE%E5%8A%A0%E8%BD%BD%E5%99%A8%20TileView%20%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <id>http://yoursite.com/2019/03/10/å¤§å›¾åŠ è½½å™¨ TileView å®è·µæ¢ç´¢ï¼ˆä¸Šï¼‰/</id>
    <published>2019-03-10T15:14:04.542Z</published>
    <updated>2020-04-13T17:41:01.435Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2020/04/10/9voj2lwLBfiWdEy.jpg" alt="tiles.jpg"></p><a id="more"></a><p>åœ¨æ˜¾ç¤ºå›¾ç‰‡çš„å®è·µä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªè­¦å‘Šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âš ï¸ W/OpenGLRenderer: Bitmap too large to be uploaded into a texture</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯ï¼Œå¼€å¯ç¡¬ä»¶åŠ é€Ÿä¼šé™åˆ¶å›¾ç‰‡çš„å¤§å°ï¼Œä¸åŒçš„è®¾å¤‡è¿˜ä¼šæœ‰ä¸åŒçš„æœ€å¤§å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥é€šè¿‡ canvas è·å¾—ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> maxWidth = canvas.maximumBitmapWidth</span><br><span class="line"><span class="keyword">val</span> maxHeight = canvas.maximumBitmapHeight</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¶…è¿‡é™åˆ¶çš„å›¾ç‰‡å…³é—­ç¡¬ä»¶åŠ é€Ÿï¼Œä½†è¿™åˆä¼šå¼•èµ·ä¸ªåˆ«æ€§èƒ½å ªå¿§çš„æ‰‹æœºå¡é¡¿~</p><p><img src="https://i.loli.net/2020/04/09/QIuXl27tHpGvEsh.jpg" alt="card.jpg"></p><p>é’ˆå¯¹è¿™ç§å°´å°¬çš„çŠ¶å†µï¼Œæˆ‘ä»¬ç»™å‡ºäº†ä¸¤ç§è§£å†³æ–¹æ¡ˆ</p><ul><li>å»ºè®®ç”¨æˆ·æ¢æ‰‹æœºï¼Œéƒ½9012å¹´è¿˜ç”¨ä»€ä¹ˆé­…è“çº¢ç±³å®‰å“5.0</li><li>ç¡¬ä»¶åŠ é€Ÿè¿˜æ˜¯ä¸å…³äº†ï¼ŒæŠŠå›¾ç‰‡å¤§å¸å…«å—å§</li></ul><p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œæˆ‘è§‰å¾—å¾ˆæ£’ï¼Œä½†æ˜¯æ—¥æ´»ä¼šæ‰ï¼Œè€æ¿ä¼šæŠŠæˆ‘å¤§å¸å…«å—ï¼Œåƒæˆ‘è¿™ç§ä¸ç•å¼ºæƒä½†ççˆ±ç”Ÿå‘½çš„ï¼Œä¼šé€‰æ‹©ç¬¬äºŒç§â€¦</p><h3 id="å›¾ç‰‡åˆ†å—çš„åˆ€â€”â€”BitmapRegionDecoder"><a href="#å›¾ç‰‡åˆ†å—çš„åˆ€â€”â€”BitmapRegionDecoder" class="headerlink" title="å›¾ç‰‡åˆ†å—çš„åˆ€â€”â€”BitmapRegionDecoder"></a>å›¾ç‰‡åˆ†å—çš„åˆ€â€”â€”BitmapRegionDecoder</h3><p>è¯´åˆ°è¦æŠŠå›¾ç‰‡åˆ†å—ï¼Œäººä»¬å¸¸å¸¸å°±ä¼šæƒ³åˆ°ä»–â€”â€”<strong>BitmapRegionDecoderï¼</strong></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹å®˜ç½‘å¯¹è¿™ä½å¤§å¸ˆçš„ä»‹ç»</p><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://i.loli.net/2020/04/09/tyz9FKdoU3cG2bB.png" alt="decpder.png"></h3><p>ä¸»è¦ç”¨äºåŸå›¾è¿‡å¤§æˆ–åªæ˜¾ç¤ºå›¾ç‰‡çš„å…¶ä¸­ä¸€å—ï¼Œé‚£ä¸æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ä¹ˆï¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bitmap : Bitmap = bitmapRegionDecoder.decodeRegion(rect, options)</span><br></pre></td></tr></table></figure><p>ç”±äº decodeRegion æ˜¯ä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œè¿™é‡Œå»ºè®®æ‚¨ç”¨ RxJava åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­å¤„ç†å“¦~</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ ¹æ®æ–‡æ¡£ä»‹ç»ï¼Œåœ¨è°ƒç”¨ decoder#recycle æ—¶ï¼Œå¦‚æœåˆ«çš„çº¿ç¨‹åˆšå¥½ä¹Ÿè°ƒç”¨äº† decoder#decodeRegion ã€decoder#getWidth æˆ– decoder#getHeightï¼Œ é‚£ä¹ˆå°±ä¼šå‡ºç°å¼‚å¸¸ï¼Œæ‰€ä»¥è¿™é‡Œå»ºè®®æ‚¨ç”¨çº¿ç¨‹é”æ¥ä¿è¯å¤šçº¿ç¨‹çš„è°ƒç”¨å®‰å…¨~</p><h3 id="å›¾ç‰‡åˆ†å—çš„èœè°±â€”â€”Tile"><a href="#å›¾ç‰‡åˆ†å—çš„èœè°±â€”â€”Tile" class="headerlink" title="å›¾ç‰‡åˆ†å—çš„èœè°±â€”â€”Tile"></a>å›¾ç‰‡åˆ†å—çš„èœè°±â€”â€”Tile</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»â€œç£¨åˆ€éœéœå‘å›¾ç‰‡â€äº†ï¼Œé‚£è¦æ€ä¹ˆåˆ‡å¥½å‘¢~</p><p>####åˆ†å—</p><p>æ¯”è¾ƒç®€å•çš„åšæ³•ï¼Œä»¥å±å¹•é«˜å®½ä¸ºå•ä½åˆ‡ã€‚è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒæ›´èˆ’æœç‚¹ï¼ŒæŠŠå•ä½åŠ å¤§åˆ°å±å¹•å®½é«˜çš„1.25å€ï¼Œè¿™ä¸ªç³»æ•°ä½ å¯ä»¥è‡ªå·±æ‚é‡ï¼Œä¸è¦è®©æœ€ç»ˆå€¼è¶…è¿‡ maximum å³å¯ã€‚</p><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ª Tile æ•°ç»„ï¼Œæˆ‘ä»¬å±å¹•æ»šåŠ¨åˆ°å“ªé‡Œï¼Œå°±åŠ è½½å“ªä¸€å—çš„å›¾ç‰‡ï¼Œä¸æ˜¾ç¤ºçš„å°±å›æ”¶äº†æ¥é¿å… OOMã€‚</p><p>ç„¶è€Œé—®é¢˜åˆæ¥äº†ï¼Œå‰é¢è¯´è¿‡äº†ï¼ŒdecodeRegion æ˜¯ä¸€ä¸ªè€—æ—¶è¿‡ç¨‹ï¼Œå®ƒè¦æ˜¯è¿½ä¸ä¸Šç”¨æˆ·çš„æ‰‹åŠ¿ï¼Œå°±ä¼šå‡ºç°å›¾ç‰‡ä»é»‘è‰²çš„èƒŒæ™¯ä¸­é—ªå‡ºæ¥~</p><p>####æ¸è¿›å¼åŠ è½½</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¸è¿›å¼åŠ è½½è§£å†³~</p><ul><li>é¦–å…ˆï¼Œå…ˆè§£æä¸€å¼ é•¿è¾¹æ’‘æ»¡å±å¹•çš„å›¾ç‰‡ï¼Œå¹¶æŠŠå®ƒçš„æ¯”ä¾‹æ”¾å¤§åˆ°çŸ­è¾¹æ’‘æ»¡å¤‡ç”¨ï¼Œè¿™é‡Œå«å®ƒ fullBitamp</li><li>æ¥ç€ï¼Œæˆ‘ä»¬å»éå†çœ‹çœ‹åœ¨å±å¹•å†…çš„ Tile æ˜¯ä¸æ˜¯æœ‰å¯ä»¥æ˜¾ç¤ºçš„ bitmap</li><li>å¦‚æœæ²¡æœ‰çš„è¯å°±æ˜¾ç¤º fullBitmap æ¥ç­‰å¾… decode</li><li>æ˜¾ç¤ºçš„å›æ”¶è¿‡ç¨‹ä¸­ï¼Œä¸å›æ”¶ fullBitmap å’Œ å±å¹•å†…çš„ Tile#bitmapï¼Œå…¶å®ƒçš„éƒ½å›æ”¶äº†</li></ul><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å§‹ç»ˆæœ‰ä¸€ä¸ªå…œåº•çš„ fullBitmapï¼Œå®ƒå°±åƒéšå½¢å®ˆæŠ¤è€…ï¼Œåœ¨è§£æ bitmap æ—¶å‡ºæ¥æ•‘ç«ï¼Œå ä¸ªä½æ˜¾ç¤ºè‡ªå·±çš„æ¨¡ç³Šï¼Œç­‰ bitmap åŠ è½½å®Œï¼Œä»–å°±å®Œæˆä»»åŠ¡é»˜é»˜ç¦»å¼€ã€‚</p><p>fullBitmap ç”±äºéšæ—¶å¯èƒ½è¢«éœ€è¦ï¼ŒåŠ ä¹‹å ç”¨å†…å­˜ä¸å¤§ï¼Œåœ¨å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹ä¸­ä¸€ç›´å­˜åœ¨ï¼›ç›´åˆ°å…³é—­å›¾ç‰‡ï¼Œæ‰ä¼šæŠŠå®ƒå’Œæ˜¾ç¤ºä¸­çš„ Tile#bitmap ä¸€èµ·å›æ”¶æ‰ã€‚</p><p>####sampleSize</p><p>åˆ†æå®Œæ¸è¿›å¼åŠ è½½ï¼Œæƒ³å¿…èªæ˜çš„ä½ å·²ç»å‘ç°äº†å…¶ä¸­çš„å…³é”® â€”â€” fullBitmap æ˜¯ä¸€å¼ ä½è´¨é‡çš„ã€è¢«å‹ç¼©çš„å›¾ã€‚</p><p>é‚£è¿™ç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿè®©æˆ‘ä»¬é‡æ–°çœ‹ä¸‹å®Œæ•´ç‰ˆçš„ <code>decodeRegion</code> </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> options = BitmapFactory.Options()</span><br><span class="line">options.inSampleSize = tile.sampleSize</span><br><span class="line">decoder.decodeRegion(rect, options)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ äº†è§£è¿‡å›¾ç‰‡å‹ç¼©ï¼Œæƒ³å¿…ä½ ç«‹åˆ»å°±æ˜ç™½äº†~ è¿™æ˜¯é€šè¿‡ tile#sampleSize æ¥æ§åˆ¶æ¯ä¸€å—å›¾ç‰‡çš„è§£æè´¨é‡ï¼ŒsampleSize è¶Šé«˜ï¼Œåˆ™å›¾ç‰‡è¢«å‹ç¼©çš„ç¨‹åº¦å°±è¶Šå¤§ï¼Œå†…å­˜å°±è¶Šå°ã€‚</p><p><img src="https://i.loli.net/2020/04/09/YsH2W1adgIxob4y.png" alt="tile.png"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® scale ç®—å‡ºåŒ¹é…çš„ sampleSizeï¼Œä¸åŒçš„ sampleSize å°±å¯¹åº”ä¸åŒçš„ tile æ•°ç»„ï¼ŒæŠŠå®ƒä»¬æ”¾è¿› TileMap ä¸­ã€‚æ˜¾ç¤ºçš„æ—¶å€™åªéœ€è¦æ ¹æ® scale ç®—å‡ºçš„ sampleSize åŒ¹é…åˆ°å¯¹åº”çš„ tile æ•°ç»„ï¼Œå°±å¯ä»¥ä½¿ç”¨æ›´åˆé€‚çš„ tile åŠ è½½å‡ºå¯¹åº”åŒºåŸŸçš„å›¾ç‰‡ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ® scale è®¡ç®—å‡ºç›¸åº”çš„ inSampleSize</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">calculateInSampleSize</span><span class="params">(scale: <span class="type">Float</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> reqWidth = (srcWidth * scale).toInt()</span><br><span class="line">    <span class="keyword">val</span> reqHeight = (srcHeight * scale).toInt()</span><br><span class="line">    <span class="keyword">var</span> inSampleSize = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (srcHeight &gt; reqHeight || srcWidth &gt; reqWidth) &#123;</span><br><span class="line">        <span class="keyword">val</span> heightRatio = Math.round(srcHeight / reqHeight.toFloat())</span><br><span class="line">        <span class="keyword">val</span> widthRatio = Math.round(srcWidth / reqWidth.toFloat())</span><br><span class="line">        <span class="comment">// Choose the smallest ratio as inSampleSize value, this will guarantee</span></span><br><span class="line">        <span class="comment">// a final image with both dimensions larger than or equal to the</span></span><br><span class="line">        <span class="comment">// requested height and width.</span></span><br><span class="line">        inSampleSize = min(heightRatio, widthRatio)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// We want the actual sample size that will be used, </span></span><br><span class="line">    <span class="comment">// so round down to nearest power of 2.</span></span><br><span class="line">    <span class="keyword">var</span> power = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (power * <span class="number">2</span> &lt; inSampleSize) &#123;</span><br><span class="line">        power *= <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> power</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸ºäº†ä¸å…³æ‰ç¡¬ä»¶åŠ é€Ÿæ¥ä¿è¯ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬ç”¨ BitmapRegionDecoder æŠŠå›¾ç‰‡å¤§å¸å…«å—ï¼Œæ¥ç€ç”¨ fullBitmap å®ç°äº†æ¸è¿›å¼åŠ è½½ï¼Œç”¨ scale è®¡ç®—å‡º sampleSize åˆ›å»ºå‡º TileMapï¼Œåœ¨ä¸åŒçš„ scale ä¸‹å±•ç¤ºä¸åŒè´¨é‡çš„å›¾ç‰‡å—ï¼Œä½“éªŒæ›´èˆ’é€‚çš„åŒæ—¶å å†…å­˜è¿˜ä½ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/04/10/9voj2lwLBfiWdEy.jpg&quot; alt=&quot;tiles.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¤§å›¾åŠ è½½å™¨ TileView å®è·µæ¢ç´¢ï¼ˆä¸‹ï¼‰</title>
    <link href="http://yoursite.com/2019/02/19/%E5%A4%A7%E5%9B%BE%E5%8A%A0%E8%BD%BD%E5%99%A8%20TileView%20%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
    <id>http://yoursite.com/2019/02/19/å¤§å›¾åŠ è½½å™¨ TileView å®è·µæ¢ç´¢ï¼ˆä¸‹ï¼‰/</id>
    <published>2019-02-19T13:18:09.587Z</published>
    <updated>2020-04-13T17:41:22.009Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2020/04/10/FqybNGsftElHg3d.jpg" alt="long.jpg"></p><a id="more"></a><p>ä¸Šç¯‡æ–‡ç« æˆ‘ä»¬åˆ†æäº†å¦‚ä½•æŠŠé•¿å›¾åŠ è½½çš„é—®é¢˜å¤§å¸å…«å—ï¼Œæœ¬ç¯‡æ–‡ç« å°†ä»è‡ªå®šä¹‰ <strong>Touch</strong> äº‹ä»¶å¤„ç†å’Œ <strong>ä¸­å›¾æ¸è¿›</strong> ä¸¤æ–¹é¢è®²è¿°</p><h3 id="onTouch"><a href="#onTouch" class="headerlink" title="onTouch"></a>onTouch</h3><p>å› ä¸ºæœ‰äº†å›¾ç‰‡çš„æ¸è¿›æ˜¾ç¤ºï¼Œæ‰€ä»¥è‡ªå·±å®ç° Touch äº‹ä»¶æ¯”è¾ƒçµæ´»ï¼Œä¾¿äºåæœŸæ‰©å±•</p><p><img src="https://i.loli.net/2020/04/10/mAjz61u9tIFXkw8.png" alt="onTouch"></p><p>é¦–å…ˆï¼Œscale æ˜¯ç”¨æ¥è¡¨ç¤ºå›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹çš„ï¼Œtranslation æ˜¯ç”¨æ¥æ ‡è®°å±å¹•å·¦ä¸Šè§’ç›¸å¯¹äºå›¾ç‰‡çš„ä½ç½®ï¼Œç”¨äºæ”¹å˜å›¾ç‰‡ä½ç½®</p><p><code>singeTap</code>ã€<code>doubleTap</code> å’Œ <code>fling</code> å¯ä»¥åˆ›å»º <code>GestureDetectorCompat</code> æ¥åˆ¤æ–­ï¼Œå…¶ä¸­ <code>singeTap</code> æŠŠç‚¹å‡»äº‹ä»¶å¤–éƒ¨ï¼›</p><p><code>doubleTap</code> ä½¿ç”¨åŒå‡»ä½ç½®çš„åæ ‡ã€ç›¸å¯¹äºå›¾ç‰‡çš„åæ ‡å’Œæœ€ç»ˆç¼©æ”¾ç³»æ•°æ”¹å˜ scale å’Œ translationï¼Œä¸ºäº†è®©ç¼©æ”¾æ›´åŠ è‡ªç„¶ï¼ŒåŠ ä¸Šäº†ç¼“åŠ¨åŠ¨ç”»ã€‚åŠ¨ç”»ç»“æŸååˆ·æ–° Tiles â€”â€” åŠ è½½æ–°çš„ bitmap å¹¶å›æ”¶è§†é‡ä¹‹å¤–çš„ bitmap</p><p><code>fling</code>  ä½¿ç”¨æ»‘åŠ¨é€Ÿåº¦å’Œå½“å‰çš„ translation è®¡ç®—å‡ºæœ€ç»ˆæ»‘åŠ¨ä½ç½®ï¼Œè¿™é‡Œä¹Ÿç”¨ç¼“åŠ¨åŠ¨ç”»è®©å›¾ç‰‡åœ¨æ»‘åŠ¨çš„æœ€åæ…¢æ…¢åœä¸‹æ¥ã€‚åœ¨åŠ¨ç”»ç»“æŸåï¼Œå›¾ç‰‡å¦‚åˆ°è¾¾è¾¹ç¼˜åˆ™å¤„ç† Drag äº‹ä»¶ï¼Œå¦åˆ™å°±ä¹Ÿè¦åˆ·æ–° Tiles</p><p><code>singleTouch</code> åˆ™æ˜¯å¤„ç†å•æŒ‡æ»‘åŠ¨å›¾ç‰‡çš„æƒ…å†µï¼Œåœ¨ <code>ACTION_DOWN</code> è®°å½•èµ·å§‹ä½ç½®ï¼Œåœ¨ <code>ACTION_MOVE</code> æ”¹å˜ translation ï¼Œåœ¨ <code>ACTION_MOVE</code> æ›´æ–° Tilesï¼Œè¿™æ ·æ¥å®ç°å•æŒ‡æ»‘åŠ¨ï¼›è€Œå®é™…å¤„ç†è¿˜è¦å¤šä¸€ç‚¹ï¼Œåœ¨ <code>ACTION_DOWN</code>  ä¸­è®°å½•ç‚¹å‡»æ—¶é—´æ¥å®ç°å›¾ç‰‡é•¿æŒ‰ï¼Œé¿å… touch äº‹ä»¶å¤„ç†çš„è¯¯è§¦å‘ LongClickï¼›åœ¨ <code>ACTION_MOVE</code> éœ€è¦å¤„ç†æ»‘åŠ¨å†²çªï¼Œå…¼å®¹ ViewPagerï¼›åœ¨ <code>ACTION_MOVE</code> å’Œ <code>ACTION_DOWN</code> ä¸­å¤„ç† Drag äº‹ä»¶ï¼Œæ¥å®Œæˆæ‹–æ‹½å…³é—­å›¾ç‰‡çš„åŠŸèƒ½</p><p><code>multiTouch</code> å¤„ç†çš„æ˜¯åŒæŒ‡ç¼©æ”¾å›¾ç‰‡ï¼Œåœ¨ <code>ACTION_POINTER_DOWN</code> ä¸­è®°å½•åŒæŒ‡è·ç¦»å’ŒåŒæŒ‡ä¹‹é—´çš„ä¸­ç‚¹åæ ‡ï¼›åœ¨ <code>ACTION_MOVE</code> æ›´æ–° scale å’Œ translationï¼Œè¿™é‡Œæ³¨æ„çš„æ˜¯ï¼Œtranslation çš„æ›´æ–°ä¿è¯å›¾ç‰‡å‘ç€åŒæŒ‡ä¸­å¿ƒä½ç§»ï¼›åœ¨ <code>ACTION_POINTER_UP</code>  ä¸­å¤„ç†æŠ¬èµ·ä¸€æ ¹æ‰‹æŒ‡å˜æˆå•æŒ‡æ»‘åŠ¨çš„æƒ…å†µ</p><h3 id="ä¸­å›¾æ¸è¿›"><a href="#ä¸­å›¾æ¸è¿›" class="headerlink" title="ä¸­å›¾æ¸è¿›"></a>ä¸­å›¾æ¸è¿›</h3><p>åœ¨å¤§å›¾ä¸‹è½½å®Œåæˆ‘ä»¬æœ‰äº†æ¨¡ç³Šå›¾å‘åŸå›¾æ¸è¿›ï¼Œä½†æ˜¯åœ¨å›¾ç‰‡ä¸‹è½½è¿‡ç¨‹ä¸­éœ€è¦ä¸­å›¾è¿‡æ¸¡åˆ°å¤§å›¾æ¥æå‡ä½“éªŒ</p><p><img src="https://i.loli.net/2020/04/10/o4raDkeGlLbF3ij.png" alt="preview"></p><p><code>TileView</code> å‚è€ƒ PhotoView çš„å®ç°ï¼ŒæŠŠä¸»è¦å·¥ä½œå§”æ‰˜ç»™ <code>TileViewAttacher</code>ï¼Œå¯¹å¤–æš´éœ² <code>setPreview</code> æ¥åŠ è½½ä¸­å›¾ï¼Œ<code>setImageUri</code> æ¥åŠ è½½å¤§å›¾æ–‡ä»¶ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸­å›¾å’Œå¤§å›¾æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œé¿å…ä¸­å›¾çš„åŠ è½½å¼‚å¸¸å½±å“åˆ°å¤§å›¾</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>TileView åˆ©ç”¨åŠ è½½å¤§å›¾å¯è§çš„ä¸€å°å—æ¥é¿å…å†…å­˜æ¶ˆè€—å’Œæ»‘åŠ¨å¡é¡¿çš„é—®é¢˜ï¼Œå¹¶åˆ©ç”¨ä¸åŒçš„ scale è®¡ç®—å‡ºä¸åŒæ¸…æ™°åº¦çš„å›¾ç‰‡å®ç°æ¸è¿›æ€§åŠ è½½ï¼›åˆ©ç”¨ <code>GestureDetectorCompat</code> å¤„ç†ä¸åŒæ‰‹åŠ¿ä¸‹çš„å¯¹åº”æ•ˆæœå¹¶ä½¿ç”¨ç¼“åŠ¨åŠ¨ç”»å®ç°è‡ªç„¶çš„ç¼©æ”¾æ»‘åŠ¨æ•ˆæœï¼›åœ¨ EventTouch ä¸­è§£å†³æ»‘åŠ¨å†²çªå…¼å®¹ ViewPagerï¼›å®ç°ä¸­å›¾å ä½è¿‡æ¸¡åˆ°å¤§å›¾ä¸‹è½½å®Œæˆï¼Œè¿›ä¸€æ­¥æå‡ä½“éªŒ</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/04/10/FqybNGsftElHg3d.jpg&quot; alt=&quot;long.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”QA</title>
    <link href="http://yoursite.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94QA/"/>
    <id>http://yoursite.com/2018/08/09/å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”QA/</id>
    <published>2018-08-09T11:49:09.000Z</published>
    <updated>2020-04-09T15:40:30.930Z</updated>
    
    <content type="html"><![CDATA[<p>é€šè¿‡ä¹‹å‰çš„æ–‡ç« ï¼Œæˆ‘å·²ç»æŠŠå¤œé—´æ¨¡å¼çš„å®ç°å’ŒåŸç†éƒ½åˆ†æå®Œäº†ï¼Œå°½ç®¡æ–¹æ¡ˆå·²ç»æ»¡è¶³å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„éœ€æ±‚ï¼Œä½†æ˜¯å®è·µè¿‡ç¨‹ä¸­è¿˜æ˜¯è¸©äº†å¾ˆå¤šå‘ã€‚æœ¬æ–‡å°±ä»¥ QA çš„å½¢å¼æŠŠå¤œé—´æ¨¡å¼çš„é‡åˆ°çš„é—®é¢˜ç®€è¦èŠä¸€èŠï¼Œå¸Œæœ›å¯ä»¥å¯¹è¯¸ä½æœ‰æ‰€å¯å‘</p><p><img src="https://i.loli.net/2020/04/09/WchdKapTJ2kbHyD.jpg" alt="q_a.jpg"></p><a id="more"></a><ul><li><p><strong>å¤œé—´æ¨¡å¼ä¸‹ Toolbar å³ä¾§å±•å¼€èœå•æ ä¸ç”Ÿæ•ˆ</strong></p><p>å› ä¸º Toolbar çš„å±•å¼€èœå•æ è‡ªå®šä¹‰æ ·å¼æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯æˆ‘å‘ç°äº†å¯ä»¥ç”¨ <code>setPopupTheme</code> æ¥æ”¹å˜ Toolbar ä¸»é¢˜ ~è¿™æ ·ï¼Œå¤œé—´æ¨¡å¼ä¸‹çš„èœå•æ çš„èƒŒæ™¯è‰²ä¼šå˜æˆé»‘è‰²ï¼Œå­—ä½“ä¼šå˜æˆç™½è‰²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">toolbar.setPopupTheme(NightHelper.isNight() </span><br><span class="line">                      ? R.style.ThemeOverlay_AppCompat_Dark </span><br><span class="line">                      : R.style.ThemeOverlay_AppCompat_Light);</span><br></pre></td></tr></table></figure></li><li><p><strong>å¤œé—´æ¨¡å¼ä¸‹ CheckBox å’Œ RadioButton ä¸ç”Ÿæ•ˆ</strong></p><p>å¦‚æœä½ ä½¿ç”¨åŸç”Ÿçš„ <strong>CheckBox</strong> æˆ–è€… <strong>RadioButton</strong> ä¼šå‘ç°å®ƒä»¬åœ¨å¤œé—´æ¨¡å¼ä¸‹é¢œè‰²æ˜¯ä¸ä¼šæ”¹å˜ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä½¿ç”¨ä½ å¤œé—´æ¨¡å¼ä¸‹çš„èµ„æºè‰²å€¼ğŸ˜‘  é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ res/color ä¸­æ–°å»ºä¸€ä¸ª thint.xml è®¾ç½®å¥½é¢œè‰²</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@color/night_gray"</span> <span class="attr">android:state_enabled</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@color/night_blue"</span> <span class="attr">android:state_checked</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"@color/night_gray"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span>`</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>app:buttonTint</code> ä¸­æŠŠ thint.xml è®¾ç½®è¿›å»å°±å¯ä»¥å•¦~</p><p>æ³¨ï¼šä¸Šè¿°å¼•ç”¨é¢œè‰²å€¼éƒ½æ˜¯åŒ…å«ä¸¤ç§æ¨¡å¼è‰²å€¼çš„</p></li><li><p><strong>å¤œé—´æ¨¡å¼ä¸‹ TabLayout å¤šçŠ¶æ€çš„ Text é¢œè‰²å¼‚å¸¸</strong></p><p>å¯¹äºå­—ä½“é¢œè‰²ï¼Œé»˜è®¤çš„åšæ³•æ˜¯é€šè¿‡ getResourceId æ¥è·å–èµ„æº Idï¼Œä½†åƒ TabLayout è¿™ç§<strong>å¤šçŠ¶æ€</strong>çš„é¢œè‰²å€¼åœ¨ TextView ä¸­æ˜¯ä½¿ç”¨ <code>ColorStateList</code> æ¥å®ç°çš„~ </p><p>æ³¨æ„âš ï¸ ä¸èƒ½ä½¿ç”¨ <code>TypedArray#getColorStateList</code>ï¼Œå› ä¸ºæ‹¿åˆ°çš„ ColorStateList æ˜¯å½“å‰æ¨¡å¼ä¸‹å·²è·å–å¥½çš„é¢œè‰²å€¼ï¼Œä¸ä¼šéšç€æ¨¡å¼çš„æ”¹å˜è€Œæ”¹å˜ğŸ˜‘ </p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¾—åœ¨åˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡ <code>TypedArray#getResourceId</code> æ‹¿åˆ°åŒ…å«å¤šç§çŠ¶æ€é¢œè‰²å€¼çš„ textColorId ï¼Œç„¶ååœ¨åˆ‡æ¢å¤œé—´æ¨¡å¼çš„æ—¶å€™è°ƒç”¨ <code>setColorStateList</code> æ¥é‡æ–°è®¾ç½®æ–°çš„ <code>ColorStateList</code></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setColorStateList</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (targetView <span class="keyword">is</span> TextView) &#123;</span><br><span class="line">         ContextCompat.getColorStateList(context, textColorId)?.also &#123;</span><br><span class="line">             targetView.setTextColor(it) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>setNightCallback è¿™ä¸ªæ–¹æ³•å¥½éº»çƒ¦å“¦ï¼Œèƒ½ä¸èƒ½åå‘æŸ¥è‰²å€¼</strong></p><p>å¦‚æœé‡åˆ°äº†åœ¨ä»£ç é‡ŒåŠ¨æ€è®¾ç½®é¢œè‰²å€¼ï¼Œæˆ‘å°±æ²¡æ³•è·å–åˆ°å®ƒçš„ rescourceIdï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ <code>setNightCallback</code> çš„å›è°ƒä¸­å†æ¸²æŸ“ä¸€æ¬¡ã€‚æ³¨æ„â—ï¸è¿™ä¸ªè§„åˆ™åªéœ€è¦åº”ç”¨äºåœ¨ MainActivity ä¸­çš„ Viewï¼Œå› ä¸ºåˆ‡æ¢å¤œé—´æ¨¡å¼å®ƒè¦é‡æ–°æ¸²æŸ“ï¼Œå…¶å®ƒæƒ…å†µçš„ View å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºï¼Œæ— é¡»åœ¨æ„è¿™ä¸ª~</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¸èƒ½é€šè¿‡é¢œè‰²å€¼åæŸ¥ rescourceId çš„åŸå› æ˜¯å› ä¸ºæ—¥é—´æ¨¡å¼ä¸‹åŒä¸€ç§é¢œè‰²å¯èƒ½å¯¹åº” n ä¸ªå¤œé—´æ¨¡å¼çš„è‰²å€¼ï¼ŒåæŸ¥ä¼šè®©è§„åˆ™å˜å¾—å¤æ‚ä¸”éº»çƒ¦â€¦â€¦</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--color in day mode--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"white_background"</span>&gt;</span>#ffffff<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"white_text"</span>&gt;</span>#0ffffff<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--color in nihgt mode--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"white_background"</span>&gt;</span>#000000<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"white_text"</span>&gt;</span>#000009<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å¤œé—´æ¨¡å¼ä¸‹å›¾ç‰‡åŠ è½½å¤§å°ä¸å¯¹</strong></p><p>å›¾ç‰‡èµ„æºä¸èƒ½å…¨éƒ¨æ”¾åœ¨ <code>drawable-night</code> ä¸­ï¼Œå®ƒæ˜¯å¯¹åº”æ—¥é—´æ¨¡å¼ drawable çš„èµ„æºï¼›å¦‚æœæ˜¯å›¾ç‰‡èµ„æºæœ‰å¯¹åº”å…³ç³»ï¼Œåº”è¯¥çœ‹å®ƒåŸå…ˆçš„ä½ç½®ï¼ŒæŠŠèµ„æºæ–‡ä»¶æ”¾åœ¨ç›¸åº”çš„ <code>drawable-night-[dpi]</code> ä¸­</p></li><li><p><strong>RecyclerView åˆ—è¡¨ä¸­çš„ Header å’Œ Footer åœ¨å®ƒä»¬ä¸å¯è§æ—¶ï¼Œä¼šå¯¼è‡´åˆ‡æ¢å¤œé—´æ¨¡å¼åæ²¡æœ‰ç”Ÿæ•ˆ</strong></p><p>åœ¨å³åˆ»ä¸­ï¼ŒHeader å’Œ Footer çš„ ViewHolder æ˜¯é€šè¿‡å˜é‡ç¼“å­˜èµ·æ¥çš„ï¼Œæ»‘åŠ¨æ—¶ä¸ä¼šé‡æ–°åˆ›å»ºä¹Ÿä¸ä¼šè¢«å¤ç”¨ï¼Œå› æ­¤åœ¨åˆ‡æ¢å¤œé—´æ¨¡å¼çš„æ—¶å€™ï¼Œå¦‚æœå®ƒä»¬ä¸å¯è§ï¼Œå°±ä¸åœ¨ rootView çš„é€’å½’èŒƒå›´å†…ï¼Œå¯¼è‡´å®ƒä»¬ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“â€¦â€¦</p><p>è§£å†³çš„æ–¹æ³•æ˜¯åœ¨åˆ‡æ¢å¤œé—´æ¨¡å¼çš„æ—¶å€™å¯¹ Header æˆ–è€… Footer è°ƒç”¨ resetViews é‡æ¸²æŸ“å®ƒä»¬çš„é¢œè‰²</p></li><li><p><strong>å¤œé—´æ¨¡å¼ä¸‹ Dialog ä¸ç”Ÿæ•ˆ</strong></p><p>å¯¹äºåŸç”Ÿçš„ AlertDialogï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªå¤œé—´æ¨¡å¼ä¸‹ Dialog çš„ä¸»é¢˜</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Dialog.Night"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Dialog.Alert"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@color/night_white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>@color/night_accent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>@color/night_text<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>@color/night_black<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ç€åˆ›å»º <code>AlertDialog.Builder</code>ï¼Œåœ¨å¤œé—´æ¨¡å¼ä¸‹åº”ç”¨å¤œé—´ä¸»é¢˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AlertDialog.Builder(<span class="keyword">if</span> (NightHelper.isNight())</span><br><span class="line">        ContextThemeWrapper(context, R.style.Dialog_Night) <span class="keyword">else</span> context)</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ WebView å¤œé—´æ¨¡å¼å¼‚å¸¸</strong></p><p>å› ä¸º WebView ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ä¼š reset UI mode, å¯¼è‡´è¯¥é¡µé¢ä¸‹åœ¨ WebView åˆå§‹åŒ–åæ¸²æŸ“çš„ View éƒ½ä¼šæ¢å¤æ—¥é—´æ¨¡å¼ï¼Œè¯¦è§ <a href="https://groups.google.com/forum/#!msg/google-admob-ads-sdk/OZzHq_-wAFY/K50jClZcBAAJ" target="_blank" rel="noopener">Google çš„è®¨è®º</a></p><p>çŸ¥é“äº†åŸå› åï¼Œè¿™ä¸ªé—®é¢˜è§£å†³èµ·æ¥ä¹Ÿæ¯”è¾ƒå®¹æ˜“ï¼Œåœ¨ WebView åˆå§‹åŒ–åè°ƒç”¨ <code>setLocalNightMode</code> æ¢å¤å¤œé—´æ¨¡å¼ï¼Œè®©å®ƒä¹‹åçš„ View æŒ‰ç…§å¤œé—´æ¨¡å¼çš„è§„åˆ™æ¸²æŸ“å³å¯ã€‚ä¸è¿‡ï¼Œä½¿ç”¨è¿™å¥—è§„åˆ™çš„ Activity éƒ½è¦æ·»åŠ   <code>android:configChanges=&quot;uiMode&quot;</code></p></li><li><p><strong>Web é¡µé¢æ²¡æœ‰å¤œé—´æ¨¡å¼å‘€</strong></p><p>é¦–å…ˆï¼Œå¦‚æœäº§å“éœ€è¦æ”¹å‰ç«¯ Web é¡µé¢é¢œè‰²ï¼Œé‚£ä¹ˆéœ€è¦å’Œå‰ç«¯åŒå­¦ä¸€èµ·é…åˆï¼ŒæŠŠä½ å½“å‰çš„çŠ¶æ€å‘Šè¯‰ä»–ã€‚å¦‚æœè¿™å—å‰ç«¯åŒå­¦è¿˜æ²¡å‡†å¤‡å¥½ï¼Œé‚£å¯ä»¥ä½¿ç”¨åœ¨ WebView ä¸­é‡å†™ onDraw çš„æ–¹æ³•ï¼Œè°ƒç”¨ <code>canvas#drawColor</code> ç»™ WebView æ·»åŠ ä¸€ä¸ªé®ç½©</p></li><li><p><strong>å›¾ç‰‡é®ç½©çš„å®ç°</strong></p><p>è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªå¤æ‚çš„åŠŸèƒ½ï¼Œåº”ç”¨æ˜¯å¦éœ€è¦å–å†³ä½ çš„è®¾è®¡å’Œäº§å“å®šä½ï¼Œæ‰€ä»¥æ²¡æœ‰å±•å¼€è®²ï¼Œä¸»è¦çš„æ€è·¯è¿˜æ˜¯ç»™ <code>ImageView#setColorFilter</code></p><p>å¦‚æœæ˜¯å¯¹ TextView è®¾ç½®äº† drawableLeft ä¹‹ç±»çš„ï¼Œéœ€è¦å¯¹ TextView çš„ drawable è¿›è¡ŒåŠ é®ç½©å¤„ç†</p><p>å¦‚æœå›¾ç‰‡åŸå…ˆæœ‰é®ç½©ï¼Œå¤œé—´æ¨¡å¼éœ€è¦è€ƒè™‘åŸå…ˆçš„é®ç½©ï¼Œæ‰€ä»¥éœ€è¦æä¾›å¤–éƒ¨æ–¹æ³•ç¦ç”¨æŸäº›å›¾ç‰‡ä¸åŠ é®ç½©</p></li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ¬æ–‡æŠŠåœ¨å®é™…å¼€å‘ä¸­é‡åˆ°çš„å°é—®é¢˜åˆ†äº«å‡ºæ¥ï¼Œå¦‚æœå¤§å®¶é‡åˆ°ä»€ä¹ˆç–‘æƒ‘ä¹Ÿå¯ä»¥ä¸æˆ‘è®¨è®ºï¼ŒæŠŠæ›´å¤šæƒ…å†µæ›´æ–°åˆ°æ–‡ç« ä¸­ğŸ‰ğŸ‰</p><h4 id="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "><a href="#å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« " class="headerlink" title="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "></a>å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« </h4><p><a href="http://wenqin231.com/2018/06/19/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%BC%80%E7%AF%87/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å¼€ç¯‡</a></p><p><a href="http://wenqin231.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å±•å¼€è®²è®²</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”æºç åˆ†æ</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94QA/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”QA</a></p><p><em>å‚è€ƒèµ„æ–™</em></p><p><a href="https://medium.com/androiddevelopers/appcompat-v23-2-daynight-d10f90c83e94" target="_blank" rel="noopener">AppCompatâ€Šâ€”â€ŠDayNight</a></p><p><a href="https://www.jianshu.com/p/3b55e84742e5" target="_blank" rel="noopener">çŸ¥ä¹å’Œç®€ä¹¦çš„å¤œé—´æ¨¡å¼å®ç°å¥—è·¯</a></p><p><strong>æ¬¢è¿å¤§å®¶æ¥<a href="http://okjike.com/careers" target="_blank" rel="noopener">å³åˆ»</a>æ‰¾æˆ‘ç©</strong>â¤ï¸</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é€šè¿‡ä¹‹å‰çš„æ–‡ç« ï¼Œæˆ‘å·²ç»æŠŠå¤œé—´æ¨¡å¼çš„å®ç°å’ŒåŸç†éƒ½åˆ†æå®Œäº†ï¼Œå°½ç®¡æ–¹æ¡ˆå·²ç»æ»¡è¶³å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„éœ€æ±‚ï¼Œä½†æ˜¯å®è·µè¿‡ç¨‹ä¸­è¿˜æ˜¯è¸©äº†å¾ˆå¤šå‘ã€‚æœ¬æ–‡å°±ä»¥ QA çš„å½¢å¼æŠŠå¤œé—´æ¨¡å¼çš„é‡åˆ°çš„é—®é¢˜ç®€è¦èŠä¸€èŠï¼Œå¸Œæœ›å¯ä»¥å¯¹è¯¸ä½æœ‰æ‰€å¯å‘&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/04/09/WchdKapTJ2kbHyD.jpg&quot; alt=&quot;q_a.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”æºç åˆ†æ</title>
    <link href="http://yoursite.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2018/08/09/å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”æºç åˆ†æ/</id>
    <published>2018-08-09T07:17:39.000Z</published>
    <updated>2020-04-09T15:38:43.228Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨<a href="http://wenqin231.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/" target="_blank" rel="noopener">ä¸Šæ–‡</a>çš„ç»“å°¾è°ˆåˆ°äº†ä¸€ä¸ªæ–°çš„éœ€æ±‚â€”â€”å‡è®¾æŸä¸ªé¡µé¢ä¸éœ€è¦å¤œé—´æ¨¡å¼ï¼Œé‚£ä¹ˆå°±è°ƒç”¨ <code>setLocalNightMode</code> æ¥æ”¹å˜å¤œé—´æ¨¡å¼çŠ¶æ€ï¼Œä»è€Œå–æ¶ˆæ‰è¿™ä¸ªé¡µé¢çš„å¤œé—´æ¨¡å¼ï¼Œä½†æ˜¯å…¶å®è¿™ç§æ–¹å¼ä¼šå½±å“åˆ°ä¸Šä¸€ä¸ªé¡µé¢çš„ UI ~</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setLocalNightMode</span><span class="params">(activity: <span class="type">AppCompatActivity</span>, isNight: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    activity.delegate.setLocalNightMode(<span class="keyword">if</span> (isNight)</span><br><span class="line">        AppCompatDelegate.MODE_NIGHT_YES <span class="keyword">else</span> AppCompatDelegate.MODE_NIGHT_NO)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›é¡¾ä¹‹å‰å°è£…çš„ <code>setLocalNightMode</code> å¯ä»¥å‘ç°ï¼Œè°ƒç”¨çš„ä¸»è§’æ˜¯ <code>activity#delegate</code>ï¼Œä½†æ˜¯å®ƒä¸ä»…æ”¹å˜äº†å½“å‰ Activity çš„å¤œé—´æ¨¡å¼ï¼Œç”šè‡³è¿å…¶å®ƒã€Œæ´»ç€çš„ã€Activity ä¹Ÿè¢«å…¶è¿ç´¯ã€‚é‚£è¿™ç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæœ¬æ–‡å°†åˆ†æè¿™å…¶ä¸­çš„æºç å®ç°ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£è¿™å¥—å®˜æ–¹çš„ Android å¤œé—´æ¨¡å¼</p><p><img src="https://i.loli.net/2020/04/09/IV3LJSvtKb8hTzQ.jpg" alt="dev.jpg"></p><a id="more"></a><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <code>setLocalNightMode</code> çš„è°ƒç”¨ä¸»è§’ <code>getDelegate</code>ï¼Œåœ¨ <code>AppCompatActivity</code> ä¸­æ‰¾åˆ° <code>getDelegate</code> çš„å…·ä½“å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AppCompatDelegate <span class="title">getDelegate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mDelegate == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mDelegate = AppCompatDelegate.create(<span class="keyword">this</span>, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mDelegate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæ‡’æ±‰å¼çš„å•ä¾‹ï¼Œé€šè¿‡ <code>AppCompatDelegate#create</code> æ¥è·å¾— <code>mDelegate</code>ã€‚<code>AppCompatDelegate</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œåœ¨å®ƒçš„ <code>create</code> æ–¹æ³•ä¸­æ ¹æ®ä¸åŒçš„ Android ç‰ˆæœ¬åˆ›å»ºå¯¹åº”çš„ç»§æ‰¿ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> AppCompatDelegate <span class="title">create</span><span class="params">(Context context, Window window,</span></span></span><br><span class="line"><span class="function"><span class="params">        AppCompatCallback callback)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">24</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AppCompatDelegateImplN(context, window, callback);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">23</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AppCompatDelegateImplV23(context, window, callback);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AppCompatDelegateImplV14(context, window, callback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•åœ°çœ‹è¿™å‡ ä¸ªç±»ï¼Œå°±ä¼šå‘ç°æœ€ä¸»è¦çš„å®ç°æ˜¯åœ¨ <code>AppCompatDelegateImplV14</code>ï¼Œå…¶ä»–ç±»çš„æ‰©å±•æ–¹æ³•ä¸å¤œé—´æ¨¡å¼æ— å…³ï¼Œé¡ºä¾¿æˆ‘ä»¬è·å¾—ä¸€ä¸ªæœ‰ç”¨çš„ä¿¡æ¯ï¼Œå½“å‰å¤œé—´æ¨¡å¼çš„åŠŸèƒ½æœ€ä½æ”¯æŒ API14 ~</p><p>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨ <code>AppCompatDelegateImplV14</code> ä¸­æ‰¾åˆ°äº† <code>setLocalNightMode</code> çš„å…·ä½“å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocalNightMode</span><span class="params">(@NightMode <span class="keyword">final</span> <span class="keyword">int</span> mode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">        <span class="keyword">case</span> MODE_NIGHT_AUTO:</span><br><span class="line">        <span class="keyword">case</span> MODE_NIGHT_NO:</span><br><span class="line">        <span class="keyword">case</span> MODE_NIGHT_YES:</span><br><span class="line">        <span class="keyword">case</span> MODE_NIGHT_FOLLOW_SYSTEM:</span><br><span class="line">            <span class="keyword">if</span> (mLocalNightMode != mode) &#123;</span><br><span class="line">                mLocalNightMode = mode;</span><br><span class="line">                <span class="keyword">if</span> (mApplyDayNightCalled) &#123;</span><br><span class="line">                    <span class="comment">// If we've already applied day night, re-apply since we won't be</span></span><br><span class="line">                    <span class="comment">// called again</span></span><br><span class="line">                    applyDayNight();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">     ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­çœ‹å‡ºï¼Œ<code>setLocalNightMode</code> é™¤äº†æŠŠ mode èµ‹å€¼ç»™ mLocalNightMode å¤–ï¼Œè¿˜ä¼šè°ƒç”¨ä¸€é <code>applyDayNight</code> æ¥ä½¿å¤œé—´æ¨¡å¼ç”Ÿæ•ˆã€‚é¡ºå¸¦ä¸€æï¼Œ <code>appDayNight</code> è¿˜ä¼šåœ¨ Activity çš„ <code>onCreate</code> å’Œ <code>onStart</code> ä¸­è¢«è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ Activity å¯åŠ¨çš„æ—¶å€™å°±ä¼šæ ¹æ® mode æ¥é€‚é…å¤œé—´æ¨¡å¼~ </p><p>é‚£æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">applyDayNight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> applied = <span class="keyword">false</span>;</span><br><span class="line">    <span class="meta">@NightMode</span> <span class="keyword">final</span> <span class="keyword">int</span> nightMode = getNightMode();</span><br><span class="line">    <span class="meta">@ApplyableNightMode</span> <span class="keyword">final</span> <span class="keyword">int</span> modeToApply = mapNightMode(nightMode);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (modeToApply != MODE_NIGHT_FOLLOW_SYSTEM) &#123;</span><br><span class="line">        applied = updateForNightMode(modeToApply);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    mApplyDayNightCalled = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> applied;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®ƒæ˜¯é€šè¿‡ <code>getNightMode</code> å’Œ <code>mapNightMode</code> è·å¾—æœ€ç»ˆ modeï¼Œæˆ‘ä»¬å…ˆçœ‹å‰è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NightMode</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getNightMode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mLocalNightMode != MODE_NIGHT_UNSPECIFIED ? </span><br><span class="line">        mLocalNightMode : getDefaultNightMode();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœ mLocalNightMode æ˜¯æœ‰æ•ˆå€¼ï¼Œå°±ä½¿ç”¨ mLocalNightMode, å¦åˆ™ä½¿ç”¨ <code>getDefalutNightMode</code>ã€‚<code>getDefalutNightMode</code> æ˜¯  <code>AppCompatDelegate</code> ä¸­çš„æ–¹æ³•ï¼Œå®ƒè¿”å› <code>setDefaultNightMode</code> è®¾ç½®çš„ modeã€‚è¿™ä¸ªæ–¹æ³•å‘Šè¯‰äº†æˆ‘ä»¬ï¼ŒlocalNightMode ä¼˜å…ˆäº defaultNightMode !</p><p><code>mapNightMode</code> åªæ˜¯å¯¹ mode çš„ç±»å‹è½¬æ¢ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚å›è¿‡å¤´æ¥ç»§ç»­çœ‹ <code>applyDayNight</code>~ å½“æˆ‘ä»¬æŠŠå¤œé—´æ¨¡å¼çš„ mode è®¾ç½®ä¸º<code>MODE_NIGHT_YES</code> æˆ–è€… <code>MODE_NIGHT_NO</code> æ—¶ï¼Œå°±ä¼šè§¦å‘ <code>updateForNightMode</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Updates the &#123;<span class="doctag">@link</span> Resources&#125; configuration &#123;<span class="doctag">@code</span> uiMode&#125; with the</span></span><br><span class="line"><span class="comment"> * chosen &#123;<span class="doctag">@code</span> UI_MODE_NIGHT&#125; value.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">updateForNightMode</span><span class="params">(@ApplyableNightMode <span class="keyword">final</span> <span class="keyword">int</span> mode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Resources res = mContext.getResources();</span><br><span class="line">    <span class="keyword">final</span> Configuration conf = res.getConfiguration();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> currentNightMode = conf.uiMode &amp; Configuration.UI_MODE_NIGHT_MASK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> newNightMode = (mode == MODE_NIGHT_YES)</span><br><span class="line">            ? Configuration.UI_MODE_NIGHT_YES</span><br><span class="line">            : Configuration.UI_MODE_NIGHT_NO;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentNightMode != newNightMode) &#123;</span><br><span class="line">        <span class="keyword">if</span> (shouldRecreateOnNightModeChange()) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">final</span> Configuration config = <span class="keyword">new</span> Configuration(conf);</span><br><span class="line">            <span class="keyword">final</span> DisplayMetrics metrics = res.getDisplayMetrics();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Update the UI Mode to reflect the new night mode</span></span><br><span class="line">            config.uiMode = newNightMode | </span><br><span class="line">                (config.uiMode &amp; ~Configuration.UI_MODE_NIGHT_MASK);</span><br><span class="line">            res.updateConfiguration(config, metrics);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçœç•¥äº†ä¸€äº›ä»£ç ï¼Œå…³é”®çš„ä»£ç æ˜¯ <code>Resoures#updateConfiguration</code>ï¼Œå®ƒä¼šæ›´æ–°èµ„æºæ–‡ä»¶çš„å¼•ç”¨è§„åˆ™â€”â€”ä¼˜å…ˆä½¿ç”¨ night æ–‡ä»¶ä¸‹çš„èµ„æºï¼Œèµ„æºç¼ºå¤±æ‰ä½¿ç”¨é»˜è®¤èµ„æº</p><p>åˆ†æåˆ°è¿™é‡Œï¼Œç»ˆäºæç„¶å¤§æ‚Ÿï¼å› ä¸º <code>setLocalNightMode</code> æœ€ç»ˆæ›´æ”¹çš„æ˜¯å…¨å±€çš„èµ„æºæ–‡ä»¶å¼•ç”¨æ–¹å¼ï¼Œæ‰€ä»¥æ˜¯åœ¨å½“å‰é¡µé¢ä¿®æ”¹çš„å¤œé—´æ¨¡å¼ï¼Œå…¶å®ä¹Ÿä¼šå¯¹å…¶ä»–å¯åŠ¨ç€çš„é¡µé¢æœ‰æ‰€å½±å“~</p><p><img src="https://i.loli.net/2020/04/09/UbndvV2zkMHIO3m.jpg" alt="soga.jpeg"></p><p>å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢æƒ³ç¦ç”¨å¤œé—´æ¨¡å¼ï¼Œåªèƒ½æŠŠè‰²å€¼æ¢æˆæ²¡æœ‰é…å¯¹å¤œé—´æ¨¡å¼çš„è‰²å€¼~ å½“ç„¶ï¼Œå¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼ï¼Œæ¬¢è¿ä¸æˆ‘è®¨è®º~</p><h4 id="æ›´å¤šç»†èŠ‚"><a href="#æ›´å¤šç»†èŠ‚" class="headerlink" title="æ›´å¤šç»†èŠ‚"></a>æ›´å¤šç»†èŠ‚</h4><p>è™½ç„¶å¤œé—´æ¨¡å¼çš„å¤§ä½“å®ç°å’ŒåŸç†æˆ‘éƒ½åˆ†æè¿‡äº†ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šç»†èŠ‚é—®é¢˜ä¸å¤ªé€‚åˆèŠ±å¤§é‡çš„ç¯‡å¹…æè¿°ã€‚å› æ­¤ï¼Œåœ¨<a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94QA/" target="_blank" rel="noopener">ã€Œå¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”QAã€</a>ä¸­ï¼Œå°†ä¼šä»¥é—®ç­”çš„å½¢å¼å¯¹è¿™äº›ç»†èŠ‚åšé€ä¸€åˆ†æï¼Œæ­å€™æŸ¥é˜…~</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å½“æˆ‘ä»¬é€šè¿‡ <code>setDefalutNightMode</code> çš„æ—¶å€™ï¼Œ<code>Activity#onCreate</code> ä¼šè°ƒç”¨ <code>applyDayNight</code>ï¼Œå†…éƒ¨ä¼šæ ¹æ® defaultNightMode æ¥ç¡®å®šèµ„æºå¼•ç”¨æ–¹å¼ï¼›å½“æˆ‘ä»¬åˆ‡æ¢å¤œé—´æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ <code>setLocalNightMode</code>ï¼Œè¿™ä¸ªæ–¹æ³•å†…ä¼šè°ƒç”¨ <code>applyDayNight</code>ï¼Œå†…éƒ¨æ˜¯å¿½ç•¥ä¹‹å‰çš„ defalutNightModeï¼Œè€Œæ˜¯ç”¨ localNightMode æ¥ç¡®å®šæ–°çš„èµ„æºå¼•ç”¨æ–¹å¼ã€‚å› ä¸ºå½“å‰é¡µé¢çš„ UI å·²ç»æ¸²æŸ“å®Œæˆäº†ï¼Œæ–°çš„èµ„æºå¼•ç”¨æ–¹å¼åªå¯¹è°ƒç”¨ <code>setLocalNightMode</code> åçš„æ¸²æŸ“æœ‰æ•ˆï¼Œæ‰€ä»¥å®˜æ–¹å»ºè®®é…åˆ <code>activity#recreate</code> æ¥å®ç°ã€‚ä½†æ˜¯é‡å¯é¡µé¢ UI ä¸Šä¸å‹å¥½ï¼Œæ•…ä½¿ç”¨ <code>NightHeper#resetViews</code> å¯¹æ¸²æŸ“å¥½çš„ UI é€’å½’éå†ï¼Œé‡æ–°æ¸²æŸ“~</p><h4 id="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "><a href="#å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« " class="headerlink" title="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "></a>å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« </h4><p><a href="http://wenqin231.com/2018/06/19/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%BC%80%E7%AF%87/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å¼€ç¯‡</a></p><p><a href="http://wenqin231.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å±•å¼€è®²è®²</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”æºç åˆ†æ</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94QA/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”QA</a></p><p><em>å‚è€ƒèµ„æ–™</em></p><p><a href="https://medium.com/androiddevelopers/appcompat-v23-2-daynight-d10f90c83e94" target="_blank" rel="noopener">AppCompatâ€Šâ€”â€ŠDayNight</a></p><p><a href="https://www.jianshu.com/p/3b55e84742e5" target="_blank" rel="noopener">çŸ¥ä¹å’Œç®€ä¹¦çš„å¤œé—´æ¨¡å¼å®ç°å¥—è·¯</a></p><p><a href="https://www.uisdc.com/tencent-qq-night-mode" target="_blank" rel="noopener">è¶…è¿‡8äº¿äººä½¿ç”¨çš„QQï¼Œæ€»ç»“äº†å¤œé—´æ¨¡å¼è®¾è®¡çš„é€šç”¨æ–¹æ³•</a></p><p><strong>æ¬¢è¿å¤§å®¶æ¥<a href="http://okjike.com/careers" target="_blank" rel="noopener">å³åˆ»</a>æ‰¾æˆ‘ç©</strong>â¤ï¸</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨&lt;a href=&quot;http://wenqin231.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸Šæ–‡&lt;/a&gt;çš„ç»“å°¾è°ˆåˆ°äº†ä¸€ä¸ªæ–°çš„éœ€æ±‚â€”â€”å‡è®¾æŸä¸ªé¡µé¢ä¸éœ€è¦å¤œé—´æ¨¡å¼ï¼Œé‚£ä¹ˆå°±è°ƒç”¨ &lt;code&gt;setLocalNightMode&lt;/code&gt; æ¥æ”¹å˜å¤œé—´æ¨¡å¼çŠ¶æ€ï¼Œä»è€Œå–æ¶ˆæ‰è¿™ä¸ªé¡µé¢çš„å¤œé—´æ¨¡å¼ï¼Œä½†æ˜¯å…¶å®è¿™ç§æ–¹å¼ä¼šå½±å“åˆ°ä¸Šä¸€ä¸ªé¡µé¢çš„ UI ~&lt;/p&gt;
&lt;figure class=&quot;highlight kotlin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setLocalNightMode&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(activity: &lt;span class=&quot;type&quot;&gt;AppCompatActivity&lt;/span&gt;, isNight: &lt;span class=&quot;type&quot;&gt;Boolean&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    activity.delegate.setLocalNightMode(&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isNight)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        AppCompatDelegate.MODE_NIGHT_YES &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; AppCompatDelegate.MODE_NIGHT_NO)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å›é¡¾ä¹‹å‰å°è£…çš„ &lt;code&gt;setLocalNightMode&lt;/code&gt; å¯ä»¥å‘ç°ï¼Œè°ƒç”¨çš„ä¸»è§’æ˜¯ &lt;code&gt;activity#delegate&lt;/code&gt;ï¼Œä½†æ˜¯å®ƒä¸ä»…æ”¹å˜äº†å½“å‰ Activity çš„å¤œé—´æ¨¡å¼ï¼Œç”šè‡³è¿å…¶å®ƒã€Œæ´»ç€çš„ã€Activity ä¹Ÿè¢«å…¶è¿ç´¯ã€‚é‚£è¿™ç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæœ¬æ–‡å°†åˆ†æè¿™å…¶ä¸­çš„æºç å®ç°ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£è¿™å¥—å®˜æ–¹çš„ Android å¤œé—´æ¨¡å¼&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/04/09/IV3LJSvtKb8hTzQ.jpg&quot; alt=&quot;dev.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å±•å¼€è®²è®²</title>
    <link href="http://yoursite.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/"/>
    <id>http://yoursite.com/2018/08/08/å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å±•å¼€è®²è®²/</id>
    <published>2018-08-08T03:21:55.000Z</published>
    <updated>2020-04-09T15:32:55.202Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰¿æ¥ä¸Šæ–‡ï¼Œä½¿ç”¨ <code>setDefaultNightMode</code> æ¥è®¾ç½®å…¨å±€çš„æ—¥å¤œé—´æ¨¡å¼ï¼Œä½†å®ƒå¯¹å¯åŠ¨è¿‡çš„ Activity æ— æ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—ä½¿ç”¨ <code>setLocalNightMode</code> è®¾ç½®å¯åŠ¨ç€çš„ Activity çš„å¤œé—´æ¨¡å¼ï¼Œå†å¯¹å¸ƒå±€å†…çš„ View é‡æ–°æ¸²æŸ“é¢œè‰²å€¼æ¥åˆ‡æ¢å¤œé—´æ¨¡å¼ã€‚è¿™çœ‹ä¸Šå»å¥½åƒå¹¶ä¸å¤æ‚ï¼Œé‚£å…·ä½“çš„å®ç°æ˜¯æ€æ ·çš„ï¼Œæœ¬æ–‡å°†å±•å¼€è®²è®²è¿™å¥—å¤œé—´æ¨¡å¼çš„å…·ä½“å®ç°~</p><p><img src="https://i.loli.net/2020/04/09/y1XaHoGvMtndAZb.jpg" alt="header.jpg"></p><a id="more"></a><h4 id="æ•´ç†é¢œè‰²å€¼"><a href="#æ•´ç†é¢œè‰²å€¼" class="headerlink" title="æ•´ç†é¢œè‰²å€¼"></a>æ•´ç†é¢œè‰²å€¼</h4><p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚å®è·µå¤œé—´æ¨¡å¼çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯æ•´ç†åº”ç”¨å†…çš„é¢œè‰²å€¼ã€‚è¿™ç›¸å½“äºå¯¹æ•´ä¸ªåº”ç”¨å†…é¢œè‰²ä½¿ç”¨è¿›è¡Œä¸€æ¬¡å¤§æ‰«é™¤ï¼Œå¹¶å¯¹é‚£äº›ä¸ç”¨ <code>@color</code> çš„åœ°æ–¹è§„èŒƒä¸€ä¸‹ï¼Œæœ€åæŠŠæ•´ç†å‡ºæ¥çš„é¢œè‰²å€¼å’Œè®¾è®¡ç»™çš„å¤œé—´æ¨¡å¼çš„é¢œè‰²å€¼å¯¹åº”èµ·æ¥ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸¤ä¸ª <code>colors.xml</code></p><p><img src="https://i.loli.net/2020/04/09/witm2YjpqgS1CPh.png" alt="colors_example.png"></p><p>ä½ å¯ä»¥æŠŠåŸºæœ¬çš„é¢œè‰²å€¼æ”¾åˆ° <code>base_colors.xml</code> ä¸­ï¼Œè€Œéœ€è¦å¤œé—´æ¨¡å¼çš„é¢œè‰²å€¼ä½¿ç”¨ <code>night_</code> å¼€å¤´å‘½åæ”¾è¿› <code>colors.xml</code> ä¸­ã€‚ä¸ºäº†è®©æ”¹åŠ¨æ›´å°ï¼Œä½ ä¹Ÿå¯ä»¥ç»“åˆè‡ªèº«åº”ç”¨æƒ…å†µå‘½å~</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"night_background_white"</span>&gt;</span>@color/white<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"night_text_black"</span>&gt;</span>@color/black<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å‘½åä¸º values-nightï¼ŒæŠŠå¤œé—´æ¨¡å¼ä¸­çš„é¢œè‰²å€¼æ”¾åœ¨è¿™ä¸ª <code>colors.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"night_background_white"</span>&gt;</span>@color/black<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"night_text_black"</span>&gt;</span>@color/white<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼<strong>å®ƒä»¬çš„é¢œè‰²å€¼å‘½åå¿…é¡»ç›¸åŒï¼</strong>å½“ä½ åˆ‡æ¢å¤œé—´æ¨¡å¼åï¼Œç³»ç»Ÿå°±ä¼šä½¿ç”¨ values-night ä¸­çš„é¢œè‰²å€¼æ¥æ¸²æŸ“æ–°çš„é¡µé¢~</p><p>å›¾ç‰‡èµ„æºä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ŒæŠŠéœ€è¦ç”¨åˆ°çš„å¤œé—´æ¨¡å¼çš„èµ„æºæ”¾åˆ°ç›¸åº”çš„ <code>night_</code> æ–‡ä»¶å¤¹ä¸­å³å¯â€¦</p><h4 id="NightHelper"><a href="#NightHelper" class="headerlink" title="NightHelper"></a>NightHelper</h4><p>ç”±äºå®˜æ–¹çš„ API æ²¡æœ‰è·å–å½“å‰å¤œé—´æ¨¡å¼çŠ¶æ€çš„é è°±æ–¹æ³•ï¼Œæ‰€ä»¥åªèƒ½æŠŠå¤œé—´æ¨¡å¼çš„çŠ¶æ€å€¼ç”¨ <code>SharedPreference</code> æŒä¹…åŒ–å­˜å‚¨ä¸‹æ¥ã€‚ç„¶åï¼Œæˆ‘å°±å¯ä»¥åœ¨åº”ç”¨å¯åŠ¨çš„è‡ªå®šä¹‰ Application ä¸­è°ƒç”¨ <code>setDefaultNightMode(isNight)</code>  ï¼Œè®©åº”ç”¨å¯åŠ¨çš„æ—¶å€™å°±ç”¨ä¹‹å‰ä¿å­˜çš„å¤œé—´æ¨¡å¼çŠ¶æ€æ¥æ¸²æŸ“ UIã€‚</p><p>è¿™é‡Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª <code>NightHelper</code> çš„å·¥å…·ç±»æ¥å¸®åŠ©æˆ‘æŠŠè¿™äº›æ“ä½œå°è£…èµ·æ¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NightHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> const <span class="keyword">val</span> KEY_NIGHT_MODE = <span class="string">"key_night_mode"</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">isNight</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> SpHelper&lt;<span class="built_in">Boolean</span>&gt;().<span class="keyword">get</span>(KEY_NIGHT_MODE, <span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">setNight</span><span class="params">(isNight: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">            SpHelper&lt;<span class="built_in">Boolean</span>&gt;().put(KEY_NIGHT_MODE, isNight)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">setDefaultNightMode</span><span class="params">(isNight: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">            AppCompatDelegate.setDefaultNightMode(<span class="keyword">if</span> (isNight)</span><br><span class="line">                AppCompatDelegate.MODE_NIGHT_YES <span class="keyword">else</span> AppCompatDelegate.MODE_NIGHT_NO)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="setLocalNightMode"><a href="#setLocalNightMode" class="headerlink" title="setLocalNightMode"></a>setLocalNightMode</h4><p>é€šè¿‡ä¸Šé¢çŒ›å¦‚è™çš„ä¸€é¡¿æ“ä½œåï¼Œå¤œé—´æ¨¡å¼çš„æ•ˆæœåŸºæœ¬å·²ç»å®Œæˆäº† 95% ï¼Œåˆ‡æ¢çš„æ—¶å€™å¯ä»¥è¿™æ ·è°ƒç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">toggleNightMode</span><span class="params">(isNight: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    NightHelper.apply &#123;</span><br><span class="line">    setDefaultNightMode(isNight)</span><br><span class="line">    setNight(isNight)   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œé™¤äº† <code>MainActivity</code> è¿™ä¸ªå·²ç»å¯åŠ¨è¿‡çš„ Activity å¤–ï¼Œå…¶ä»–æ–°åˆ›å»ºçš„é¡µé¢éƒ½ä¼šä½¿ç”¨å¤œé—´æ¨¡å¼çš„é¢œè‰²å€¼æ¥åˆ›å»ºã€‚æ‰€ä»¥å‰©ä¸‹çš„ 5% å°±æ˜¯è¦è®©ã€Œæ´»ç€çš„ã€çš„é¡µé¢æµç•…åœ°åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼ã€‚å¦‚æœä½ ä»”ç»†è§‚å¯Ÿæœ‰å¤œé—´æ¨¡å¼çš„ Appï¼Œä½ ä¼šå‘ç°å®ƒä»¬å¤§éƒ¨åˆ†éƒ½æŠŠé¡µé¢æ¨¡å¼çš„å¼€å…³æ”¾åœ¨ä¸€çº§é¡µé¢ä¸­ï¼Œè¿™æ ·å°±å°±å‡å°‘äº†ã€Œæ´»ç€çš„ã€é¡µé¢çš„å¤„ç†ã€‚</p><p>æ‰€ä»¥åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œã€Œæ´»ç€çš„ã€Activity ä¸€èˆ¬åªæœ‰ <code>MainActivity</code>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦åœ¨ AndroidMainfest ä¸­ç»™å®ƒè®¾ç½® <code>android:configChanges=&quot;uiMode&quot;</code>ï¼Œç„¶ååœ¨åˆ‡æ¢çš„æ—¶å€™ä½¿ç”¨ <code>setLocalNightMode</code>  çš„æ–¹æ³•æ¥ç»™å®ƒè®¾ç½®å¤œé—´æ¨¡å¼çŠ¶æ€ã€‚è¿™ä¸ªæ–¹æ³•å®˜æ–¹æ˜¯å»ºè®®é…åˆ <code>activity#recreate</code> ä½¿å…¶ç”Ÿæ•ˆã€‚ä½†è¿™æ ·å¯¹äºç”¨æˆ·æ¥è¯´ä½“éªŒè¾ƒå·®ï¼Œè€Œä¸”å¸‚é¢ä¸Šä¹Ÿå¾ˆå°‘åº”ç”¨ä¼šä½¿ç”¨è¿™æ ·çš„æ–¹å¼ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨äº†é€’å½’åˆ·æ–° UI çš„æ–¹å¼</p><p><img src="https://i.loli.net/2020/04/09/YBPgo5tMymnrC9U.jpg" alt="show.jpg"></p><h4 id="NightView"><a href="#NightView" class="headerlink" title="NightView"></a>NightView</h4><p>é‚£ä¹ˆä¸ºäº†åˆ·æ–° UIï¼Œæˆ‘å®šä¹‰äº†æ¥å£ <code>NightView</code></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">NightView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">resetNightColors</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setNightCallback</span><span class="params">(callback: <span class="type">OnNightCallback</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ï¼Œåˆ›å»º <code>NightTextView</code>ã€<code>NightFrameLayout</code>ã€<code>NightRelativeLayout</code> ç­‰ MainActivity ä¸­æœ‰ç”¨åˆ°çš„ Viewï¼Œè®©å®ƒä»¬å®ç° <code>NightView</code>ã€‚æ¯ä¸ª NightView éƒ½å§”æ‰˜ <code>NightViewAttacher</code> æ¥å¤„ç†å†…éƒ¨é€»è¾‘</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NightTextView</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">        context: Context, attrs: AttributeSet? = <span class="literal">null</span>, defStyleAttr: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">) : AppCompatTextView(context, attrs, defStyleAttr), NightView &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> attacher = NightViewAttacher(<span class="keyword">this</span>, context, attrs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">resetNightColors</span><span class="params">()</span></span> &#123;</span><br><span class="line">        attacher.setBackground()</span><br><span class="line">        attacher.setTextColor()</span><br><span class="line">        attacher.toggleCallback()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setNightCallback</span><span class="params">(callback: <span class="type">OnNightCallback</span>)</span></span> &#123;</span><br><span class="line">        attacher.setNightCallback(callback)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® View çš„ç‰¹ç‚¹åœ¨ <code>resetNightColors</code> è°ƒç”¨ç›¸åº”çš„æ–¹æ³•é‡æ–°æ¸²æŸ“è‰²å€¼ã€‚<code>setNightCallback</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œå› ä¸ºæ¶‰åŠåˆ° <code>NightAttacher</code> çš„é€»è¾‘ï¼Œæ‰€ä»¥ä¼šåœ¨ <code>NightAttacher</code> ä¸­ä»‹ç»</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½çœ‰å¤´ä¸€çš±ï¼šé‚£æ˜¯ä¸æ˜¯è¦æŠŠæ‰€æœ‰ MainActivity çš„ View å…¨éƒ¨æ›¿æ¢æˆ NightViewï¼Ÿå·¥ä½œé‡å¾ˆå¤§è€¶ï¼</p><p>å…¶å®ï¼Œå¦‚æœä½ ä»¬é¡¹ç›®ä¸­çš„ xml å…¨éƒ½ä½¿ç”¨è‡ªå®šä¹‰ Viewï¼Œé‚£åªéœ€è¦è®©å®ƒä»¬å®ç° NightView æ¥å£ï¼Œå¹¶åˆ›å»º <code>NightViewAttacher</code>ï¼Œå‰©ä¸‹çš„å·¥ä½œæ¡¥æ¥ç»™å®ƒå°±è¡Œäº†ï¼›è€Œå¦‚æœä½ ä»¬ç”¨çš„æ˜¯åŸç”Ÿçš„ Viewï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>LayoutInflaterCompat#setFactory2</code> å¯¹ xml ä¸­çš„ View è¿›è¡Œæ›¿æ¢</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">LayoutInflaterCompat.setFactory2(layoutInflater, <span class="keyword">object</span> : LayoutInflater.Factory2 &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(parent: <span class="type">View</span>, name: <span class="type">String</span>, context: <span class="type">Context</span>, attrs: <span class="type">AttributeSet</span>)</span></span>: View? &#123;</span><br><span class="line">        <span class="keyword">var</span> view: View? = <span class="literal">null</span></span><br><span class="line">       <span class="keyword">when</span> (name) &#123;</span><br><span class="line">            <span class="string">"TextView"</span> -&gt; view = NightTextView(context, attrs)</span><br><span class="line">            <span class="string">"FrameLayout"</span> -&gt; view = NightFrameLayout(context, attrs)</span><br><span class="line">            <span class="string">"RelativeLayout"</span> -&gt; view = NightRelativeLayout(context, attrs)</span><br><span class="line">                <span class="comment">// åœ¨è¿™é‡Œæ›¿æ¢ä½ éœ€è¦çš„ View</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> view ?: delegate.createView(parent, name, context, attrs)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(name: <span class="type">String</span>, context: <span class="type">Context</span>, attrs: <span class="type">AttributeSet</span>)</span></span>: View?&#123;</span><br><span class="line">        <span class="keyword">return</span> onCreateView(<span class="literal">null</span>, name, context, attrs)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œä»£ç é‡Œçš„åˆ›å»ºçš„ View ä½ è¿˜æ˜¯å¾—æ‰‹åŠ¨æ›¿æ¢æˆ <code>NightView</code>ï¼Œå¦‚ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> textView = NightTextView(context)</span><br></pre></td></tr></table></figure><h4 id="NightViewAttacher"><a href="#NightViewAttacher" class="headerlink" title="NightViewAttacher"></a>NightViewAttacher</h4><p>NightViewAttacher ä½œä¸º NightView çš„ä¸»è¦æ‰§è¡Œè€…ï¼Œè‚©ä¸Šçš„è´£ä»»å¾ˆé‡çš„~ NightView å…·ä½“çš„åˆ·æ–°å¤œé—´æ¨¡å¼æ•ˆæœéƒ½æ˜¯æ¡¥æ¥ç»™å®ƒæ¥å®ç°ã€‚é‚£ä¹ˆå®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•å®Œæˆ NightView å§”æ‰˜çš„å·¥ä½œï¼Ÿ</p><p>é¦–å…ˆï¼Œå®ƒéœ€è¦ä¸€äº›åŸç”Ÿå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ attrs æ–‡ä»¶ä¸­å¸®å®ƒå£°æ˜</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"NightView"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"android:background"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"android:tint"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå®ƒå°±å¯ä»¥åœ¨ NightViewAttacher ä¸­é€šè¿‡ <code>getResourceId</code> è·å¾—åŸç”Ÿé¢œè‰²å±æ€§~ æ³¨æ„å“¦ï¼Œè¿™ä¸ªå±æ€§æ˜¯ <code>@ColorRes</code>ï¼Œè¦é€šè¿‡ <code>ContextCompat#getColor</code> ç”Ÿæˆç›¸åº”çš„è‰²å€¼ã€‚åœ¨å¤œé—´æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¼šä» night æ–‡ä»¶ä¸­è·å–ç›¸åº”èµ„æº</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setTextColor</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (textColorId &gt; <span class="number">0</span> &amp;&amp; targetView <span class="keyword">is</span> TextView) &#123;</span><br><span class="line">        targetView.setTextColor(ContextCompat.getColor(context, textColorId))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœæ˜¯é€šè¿‡ <code>TypeArray#getColor</code> æ‹¿åˆ°çš„è‰²å€¼ä¸ä¼šæ ¹æ®å¤œé—´æ¨¡å¼çš„çŠ¶æ€å»åˆ‡æ¢ä¸åŒè‰²å€¼ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æ‹¿åˆ°çš„é¢œè‰²å€¼å·²ç»æ˜¯ <code>@ColorInt</code>ï¼Œ å°±æ— æ³•æ ¹æ®å½“å‰çš„æ¨¡å¼æ¥æ˜¾ç¤ºç›¸åº”è‰²å€¼</p><p>åœ¨ NightAttacher ä¸­ï¼Œæˆ‘ä»¬åªèƒ½è·å¾— xml ä¸­å®šä¹‰çš„è‰²å€¼ã€‚å¦‚æœæ˜¯åœ¨ä»£ç ä¸­è®¾ç½®çš„é¢œè‰²ï¼Œå°±ä¼šå¯¼è‡´åˆ‡æ¢çš„æ—¶å€™æ— æ³•æ‹¿åˆ°è‰²å€¼æ¥é‡æ–°æ¸²æŸ“ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å®šä¹‰äº† <code>setNightCallback</code> çš„æ–¹æ³•ï¼ŒæŠŠè®¾ç½®é¢œè‰²çš„æ–¹æ³•æ”¾åˆ° callback å†…éƒ¨åšã€‚åœ¨ <code>NightView#resetNightColors</code> ä¸­æŠŠ callback ä¸­çš„æ–¹æ³•å†æ‰§è¡Œä¸€éï¼Œè¾¾åˆ°é‡æ–° UI æ•ˆæœ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setNightCallback</span><span class="params">(callback: <span class="type">OnNightCallback</span>?)</span></span> &#123;</span><br><span class="line">    callback?.apply &#123;</span><br><span class="line">        call()</span><br><span class="line">        callbackList.add(<span class="keyword">this</span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">toggleCallback</span><span class="params">()</span></span> &#123;</span><br><span class="line">    callbackList.forEach &#123; it.call() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå†…éƒ¨çš„å®ç°æ— éå°±æ˜¯æŠŠ callback ç¼“å­˜èµ·æ¥ï¼Œç„¶ååœ¨ <code>toggleCallback</code> ä¸­æ‰§è¡Œï¼Œè€Œ <code>toogleCallback</code> ä¼šåœ¨ <code>NightView#resetNightColors</code> ä¸­è¢«è°ƒç”¨ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ <code>setNightCallback</code> çš„ callback ä¼šåœ¨è®¾ç½®è¿›å»çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œä¾¿äºæ›¿æ¢å¤–éƒ¨çš„æ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ å…¥å¤œé—´æ¨¡å¼å‰</span></span><br><span class="line"><span class="keyword">val</span> textView = TextView(context)</span><br><span class="line">textView.setTextColor(ContextCompat.getColor(context, R.color.night_white))</span><br><span class="line"><span class="comment">// åŠ å…¥å¤œé—´æ¨¡å¼å</span></span><br><span class="line"><span class="keyword">val</span> textView = NightTextView(<span class="keyword">this</span>)</span><br><span class="line">textView.setNightCallback(<span class="keyword">object</span> : OnNightCallback&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">call</span><span class="params">()</span></span> &#123;</span><br><span class="line">        textView.setTextColor(ContextCompat.getColor(context, R.color.night_white))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åŠ å…¥å¤œé—´æ¨¡å¼åï¼Œ<code>MainActivity</code> ä¸­åœ¨ä»£ç ä¸­è®¾ç½®é¢œè‰²çš„æ–¹æ³•è¢«æŒªåˆ° <code>setNightCallback</code> çš„å›è°ƒä¸­æ‰§è¡Œï¼Œå› ä¸º setNightCallback çš„å›è°ƒé»˜è®¤ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œå¤–éƒ¨è°ƒç”¨è€…ä½¿ç”¨èµ·æ¥å°±æ›´æ–¹ä¾¿äº†~ è¿™é‡Œå†å¼ºè°ƒä¸€éï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ä»£ç é‡Œè®¾ç½®é¢œè‰²çš„æ–¹æ³•éƒ½ç”¨ <code>setNightCallback</code>ï¼Œåªæœ‰åˆ‡æ¢æ—¶å¯åŠ¨ç€çš„ <code>MainActivity</code> æ‰éœ€è¦å“¦~</p><h4 id="resetViews"><a href="#resetViews" class="headerlink" title="resetViews"></a>resetViews</h4><p>NightView å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦åœ¨åˆ‡æ¢å¤œé—´æ¨¡å¼çš„æ—¶å€™ä½¿ç”¨å®ƒäº†~ </p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Activity ä¸­é€šè¿‡ <code>getRootView</code> æ¥è·å–æ ¹è§†å›¾</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getRootView</span><span class="params">()</span></span>: View &#123;</span><br><span class="line">    <span class="keyword">return</span> window.decorView</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢å¤œé—´æ¨¡å¼æ—¶ï¼Œå¯¹ rootView è¿›è¡Œé€’å½’éå†ï¼Œè®©ä¸»é¡µé¢æ‰€æœ‰å…ƒç´ é‡æ–°æ¸²æŸ“</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">resetViews</span><span class="params">(view: <span class="type">View</span>)</span></span> &#123;</span><br><span class="line">     view.apply &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> NightView) &#123;</span><br><span class="line">             resetNightColors()</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> ViewGroup) &#123;</span><br><span class="line">             <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until childCount) &#123;</span><br><span class="line">               resetView(getChildAt(i))</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªè¢«éå†åˆ°çš„ view å¦‚æœå®ç°äº† <code>NightView</code> æ¥å£ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œå®ƒçš„ <code>resetNightColors</code> é‡æ–°æ¸²æŸ“ UIï¼›å¦‚æœ view æ˜¯ ViewGroup ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„å­ View è¿›è¡Œéå†æ‰§è¡Œ <code>resetViews</code>ï¼Œé€’å½’ä¸‹å»å°±å¯ä»¥æŠŠæ‰€æœ‰ view çš„è‰²å€¼éƒ½é‡ç½®å•¦~</p><h4 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a>RecyclerView</h4><p>ä¸Šæ–‡æåŠï¼Œå› ä¸º RecyclerView å¸ƒå±€å¤ç”¨çš„åŸå› ï¼ŒresetView ä¼šæ¼æ‰å¤ç”¨çš„å¸ƒå±€ã€‚ItemView ä¸å¯è§å´ç¼“å­˜åœ¨ RecyclerView çš„å†…å­˜ä¸­ï¼Œæ‰€ä»¥å®ƒä»¬çš„å¸ƒå±€åœ¨åˆ‡æ¢å¤œé—´æ¨¡å¼çš„æ—¶å€™ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼Œè¿™å¯¼è‡´ RecyclerView ä¼šåœ¨æ»šåŠ¨çš„æ—¶å€™å¤ç”¨åŸå…ˆçš„æ²¡è¢«é‡æ–°æ¸²æŸ“æ–°è‰²å€¼çš„å¸ƒå±€ï¼Œæœ€ç»ˆå¯¼è‡´äº†é¡µé¢å¼‚å¸¸</p><p>è§£å†³çš„æ–¹æ³•æ˜¯æŠŠ RecyclerView ä¸­ç¼“å­˜çš„å¸ƒå±€æ¸…ç©ºæ‰ï¼Œè®© RecyclerView æ»šåŠ¨æ—¶é‡æ–°åˆ›å»ºå¸ƒå±€æˆ–è€…å¤ç”¨å·²ç»è¢«é‡æ–°æ¸²æŸ“å¥½çš„å¸ƒå±€</p><p>åˆ›å»º <code>NightRecyclerView</code> ç»§æ‰¿ RecyclerView å¹¶å®ç° NightViewï¼Œåœ¨ NightView çš„ resetNightColors ä¸­é€šè¿‡åå°„è°ƒç”¨ RecyclerView çš„ <code>mRecycler#clear</code>  æ¥æŠŠç¼“å­˜å¸ƒå±€æ¸…æ‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">resetNightColors</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> declaredField = javaClass.getDeclaredField (<span class="string">"mRecycler"</span>)</span><br><span class="line">        declaredField.isAccessible = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">val</span> declaredMethod = Class.forName(RecyclerView.Recycler::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>.<span class="title">name</span>)</span></span><br><span class="line">                .getDeclaredMethod(<span class="string">"clear"</span>, *arrayOfNulls&lt;Class&lt;*&gt;&gt;(<span class="number">0</span>) <span class="keyword">as</span> Array&lt;Class&lt;*&gt;&gt;)</span><br><span class="line">        declaredMethod.isAccessible = <span class="literal">true</span></span><br><span class="line">        declaredMethod.invoke(declaredField.<span class="keyword">get</span>(<span class="keyword">this</span>), arrayOfNulls&lt;Any&gt;(<span class="number">0</span>))</span><br><span class="line">        recycledViewPool.clear()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¦ç”¨å¤œé—´æ¨¡å¼"><a href="#ç¦ç”¨å¤œé—´æ¨¡å¼" class="headerlink" title="ç¦ç”¨å¤œé—´æ¨¡å¼"></a>ç¦ç”¨å¤œé—´æ¨¡å¼</h4><p>å½“æˆ‘ä»¬å®ç°å®Œè¿™äº›åï¼ŒåŸºæœ¬ä¸Šå¤œé—´æ¨¡å¼çš„æ•ˆæœå°±å®Œæˆäº†~ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¼šæƒ³ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›é¡µé¢æ ¹æœ¬ä¸éœ€è¦å¤œé—´æ¨¡å¼ï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™äº›é¡µé¢æˆ‘ä»¬ä¹Ÿè¦åšç‰¹æ®Šå¤„ç†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº† <code>DisableNight</code> çš„æ¥å£ï¼Œè®©ä¸éœ€è¦å¤œé—´æ¨¡å¼çš„é¡µé¢å®ç°è¿™ä¸ªæ¥å£ã€‚ç„¶ååˆ¤æ–­ï¼Œå¦‚æœé¡µé¢æ˜¯ <code>DisableNight</code>ï¼Œå°±åœ¨é¡µé¢å¯è§æ—¶è°ƒç”¨ <code>setLocalNightMode</code> è®¾ç½®æ—¥é—´æ¨¡å¼ï¼Œå¤œé—´ä¸å¯è§æ—¶è®¾ç½®å›å¤œé—´æ¨¡å¼~</p><p>è¿™çœ‹ä¼¼ç¨³å¾—ä¸€åŒ¹ï¼Œä½†å…¶å®åŒ…å«äº†ä¸€ä¸ª BUG â€”â€” <code>setLocalNightMode</code> ä¼šå½±å“æ‰€æœ‰ã€Œæ´»ç€çš„ã€é¡µé¢ã€‚å‡å¦‚ A é¡µé¢åœ¨è¯·æ±‚æ•°æ®ï¼Œè¿™æ—¶å®ƒè·³è½¬åˆ°äº†ä¸éœ€è¦å¤œé—´æ¨¡å¼çš„ Bï¼ŒB å¯è§çš„æ—¶å€™æŠŠå¤œé—´æ¨¡å¼è®¾ç½®æˆäº†æ—¥é—´æ¨¡å¼ï¼Œè¿™æ—¶åˆšå¥½ A è¯·æ±‚çš„æ•°æ®è¿”å›äº†ï¼Œå®ƒä»¬æ¸²æŸ“çš„ UI å°±å˜æˆäº†æ—¥é—´æ¨¡å¼â€¦â€¦</p><p><img src="https://i.loli.net/2020/04/09/pI2UoxTPskhc9Aj.jpg" alt="large.jpg"></p><p>é‚£ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œåˆå¾—å¦‚ä½•è§£å†³ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡<a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">ã€Œå¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”æºç åˆ†æã€</a>ä¸­ä¸€æ¢ç©¶ç«Ÿ~</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>é€šè¿‡ä¸Šæ–‡åˆ†æï¼Œæˆ‘ç›¸ä¿¡ä½ å¯¹å¤œé—´æ¨¡å¼çš„å®ç°å·²ç»æœ‰äº†åˆæ­¥çš„è®¤è¯†ï¼Œä½†æœ‰ä¸¤ä¸ªæ–¹é¢éœ€è¦ç†è§£æ¸…æ¥š</p><p>ç¬¬ä¸€ï¼Œå¤œé—´æ¨¡å¼çš„å…·ä½“æ•ˆæœä¸éš¾å®ç°ï¼Œé€šè¿‡ <code>setDefaultNightMode</code> å°±å¯ä»¥è½»æ¾å®ç°ã€‚ç¹ççš„å·¥ä½œåœ¨äºåˆ‡æ¢å¤œé—´æ¨¡å¼æ—¶ï¼Œè¦æŠŠå½“å‰çš„ MainActivity ä¸­çš„ UI é‡æ–°æ¸²æŸ“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ MainActivity ä¸­çš„ View å…¨éƒ¨æ›¿æ¢æˆ NightViewï¼Œç„¶åé€’å½’éå†ã€‚è€Œå¯¹äºç‰¹æ®Šçš„ RecyclerViewï¼Œåˆ™éœ€è¦æŠŠå®ƒå†…éƒ¨ç¼“å­˜çš„å¸ƒå±€æ¸…ç©ºæ‰</p><p>ç¬¬äºŒï¼Œæ‰€æœ‰ View æ‹¿åˆ°çš„ <code>@ColorInt</code> å€¼éƒ½æ˜¯16è¿›åˆ¶çš„æ•°å­—ï¼Œå®ƒä¸ä¼šå› ä¸ºå¤œé—´æ¨¡å¼çš„æ”¹å˜è€Œæ”¹å˜ï¼Œè€Œå¦‚æœæ‹¿åˆ°å®ƒä»¬çš„ <code>@ColorRes</code>ï¼Œå°±å¯ä»¥è®© <code>ContextCompat#getColor</code> æ ¹æ®å¤œé—´æ¨¡å¼çš„çŠ¶æ€å»æ‹¿ä¸åŒèµ„æºçš„è‰²å€¼</p><h4 id="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "><a href="#å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« " class="headerlink" title="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "></a>å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« </h4><p><a href="http://wenqin231.com/2018/06/19/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%BC%80%E7%AF%87/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å¼€ç¯‡</a></p><p><a href="http://wenqin231.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å±•å¼€è®²è®²</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”æºç åˆ†æ</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94QA/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”QA</a></p><p><em>å‚è€ƒèµ„æ–™</em></p><p><a href="https://medium.com/androiddevelopers/appcompat-v23-2-daynight-d10f90c83e94" target="_blank" rel="noopener">AppCompatâ€Šâ€”â€ŠDayNight</a></p><p><a href="https://www.jianshu.com/p/3b55e84742e5" target="_blank" rel="noopener">çŸ¥ä¹å’Œç®€ä¹¦çš„å¤œé—´æ¨¡å¼å®ç°å¥—è·¯</a></p><p><strong>æ¬¢è¿å¤§å®¶æ¥<a href="http://okjike.com/careers" target="_blank" rel="noopener">å³åˆ»</a>æ‰¾æˆ‘ç©</strong>â¤ï¸</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ‰¿æ¥ä¸Šæ–‡ï¼Œä½¿ç”¨ &lt;code&gt;setDefaultNightMode&lt;/code&gt; æ¥è®¾ç½®å…¨å±€çš„æ—¥å¤œé—´æ¨¡å¼ï¼Œä½†å®ƒå¯¹å¯åŠ¨è¿‡çš„ Activity æ— æ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—ä½¿ç”¨ &lt;code&gt;setLocalNightMode&lt;/code&gt; è®¾ç½®å¯åŠ¨ç€çš„ Activity çš„å¤œé—´æ¨¡å¼ï¼Œå†å¯¹å¸ƒå±€å†…çš„ View é‡æ–°æ¸²æŸ“é¢œè‰²å€¼æ¥åˆ‡æ¢å¤œé—´æ¨¡å¼ã€‚è¿™çœ‹ä¸Šå»å¥½åƒå¹¶ä¸å¤æ‚ï¼Œé‚£å…·ä½“çš„å®ç°æ˜¯æ€æ ·çš„ï¼Œæœ¬æ–‡å°†å±•å¼€è®²è®²è¿™å¥—å¤œé—´æ¨¡å¼çš„å…·ä½“å®ç°~&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/04/09/y1XaHoGvMtndAZb.jpg&quot; alt=&quot;header.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å¼€ç¯‡</title>
    <link href="http://yoursite.com/2018/06/19/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%BC%80%E7%AF%87/"/>
    <id>http://yoursite.com/2018/06/19/å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å¼€ç¯‡/</id>
    <published>2018-06-19T02:25:10.000Z</published>
    <updated>2020-04-09T16:18:16.235Z</updated>
    
    <content type="html"><![CDATA[<p>2018å¹´1æœˆï¼ŒYoutube å¯¹ ios å®¢æˆ·ç«¯ç°åº¦å‘å¸ƒå¤œé—´æ¨¡å¼ï¼›2018 WWDC ä¸Šï¼ŒMac OS æ·»åŠ äº†ç³»ç»Ÿçº§çš„å¤œé—´æ¨¡å¼åŠŸèƒ½ï¼Œå¯¹åº”ç”¨è¿›è¡Œå¤œé—´é€‚é…ï¼›18å¹´7æœˆï¼ŒYoutube å¯¹ Android å®¢æˆ·ç«¯ç°åº¦å‘å¸ƒäº†å¤œé—´æ¨¡å¼â€¦â€¦ è€Œåœ¨å›½å†…ï¼Œæ—©æœ‰ä¸€æ‰¹åº”ç”¨æ·»åŠ äº†å®ƒä»¬çš„å¤œé—´æ¨¡å¼ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨æ˜¯å¦éœ€è¦å¤œé—´æ¨¡å¼ï¼Œåˆè¯¥å¦‚ä½•é€‚é…å‘¢ï¼Ÿ æœ¬æ–‡å°†ä»åº”ç”¨éœ€æ±‚å’Œ Android å®ç°æ–¹æ¡ˆä¸¤ä¸ªè§’åº¦ç®€è¦è®²è¿°~</p><p><img src="https://i.loli.net/2020/04/09/heNLlSRQ1IP4mrq.jpg" alt="night_example.jpeg"></p><a id="more"></a><h4 id="åº”ç”¨éœ€æ±‚"><a href="#åº”ç”¨éœ€æ±‚" class="headerlink" title="åº”ç”¨éœ€æ±‚"></a>åº”ç”¨éœ€æ±‚</h4><p><strong>ä»åº”ç”¨äº§å“çš„è§’åº¦æ¥çœ‹</strong></p><ul><li>ç”¨æˆ·æœ‰æ²¡æœ‰å¯èƒ½åœ¨å¤œé—´é«˜é¢‘åœ°ä½¿ç”¨ä½ çš„åº”ç”¨ï¼Ÿ</li><li>ä½ çš„åº”ç”¨æœ¬èº«çš„é…è‰²æ˜¯å¦åäº®ç³»ï¼Ÿ</li><li>åé¦ˆè¿™ä¸ªéœ€æ±‚çš„ç”¨æˆ·æ•°å æ¯”é«˜ä¹ˆï¼Ÿ<ul><li>å‡å¦‚è¿™ä¸ªå æ¯”å¾ˆä½çš„è¯ï¼Œé‚£ä¹ˆå›¢é˜Ÿå¯èƒ½éœ€è¦æŠŠæ›´å¤šçš„æ—¶é—´èŠ±åœ¨å…¶ä»–éœ€æ±‚ä¸Š</li></ul></li></ul><p><strong>ä»è®¾è®¡å¸ˆçš„è§’åº¦æ¥çœ‹</strong></p><ul><li>è®¾è®¡å¸ˆå›¢é˜Ÿæ˜¯å¦èƒ½å¤Ÿæä¾›ä¸€ä»½åˆé€‚çš„è®¾è®¡ï¼Ÿ<ul><li>è®¾è®¡å¸ˆå°†å†³å®šäº†åº”ç”¨å¤œæ™šçš„æ¨¡æ ·ï¼Œå¾ˆå¤šç»†èŠ‚éƒ½è¦ä»–æ¥ç¡®å®š</li></ul></li></ul><p><strong>ä»å·¥ç¨‹å¸ˆçš„è§’åº¦æ¥çœ‹</strong></p><ul><li>å°½å¯èƒ½åœ°è®©å¤œé—´æ•ˆæœè¦†ç›–æ‰€æœ‰çš„é¡µé¢ï¼Œè€Œä¸”åˆ‡æ¢æ•ˆæœè¦æµç•…è‡ªç„¶</li><li>å¯¹åŸæœ‰ä»£ç çš„å…¥ä¾µæ€§ä½ï¼Œæ›´å°‘åœ°ä»£ç æ”¹åŠ¨</li><li>å°½é‡é¿å…ä¾µå…¥ä¸šåŠ¡ï¼Œå³å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸šåŠ¡å¼€å‘ä¸éœ€è¦å…³å¿ƒå¤œé—´æ¨¡å¼</li></ul><p>ä¸Šé¢çš„ä¸‰å±‚å…¶å®æœ‰ç‚¹é€’è¿›çš„æ„æ€ï¼Œå…¶å®åšåˆ°ç¬¬ä¸€ç‚¹ï¼Œå·¥ä½œå°±ç®—å®Œæˆäº†ã€‚ä½†æ˜¯å¦‚æœè€ƒè™‘åˆ°å¯ç»´æŠ¤æ€§å’Œâ€œäººèº«å®‰å…¨â€ï¼Œæ¥ä¸‹æ¥çš„ä¸¤ç‚¹è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼é‚£ä¹ˆï¼Œå°±è®©æˆ‘æ¥è·Ÿå¤§å®¶èŠèŠå¤œé—´æ¨¡å¼ Android çš„å®ç°ï¼Œè‡³äº web å‰ç«¯å’Œ ios â€¦â€¦</p><p><img src="https://i.loli.net/2020/04/09/iw4ED6S7sIuFkJn.jpg" alt="oh_no.jpg"></p><h4 id="Android-å®è·µæ€è·¯"><a href="#Android-å®è·µæ€è·¯" class="headerlink" title="Android å®è·µæ€è·¯"></a>Android å®è·µæ€è·¯</h4><p>å°±æˆ‘æ‰€çŸ¥ï¼Œç›®å‰ Android ç«¯å®ç°å¤œé—´æ¨¡å¼æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ol><li>Google çš„åŸç”Ÿæ”¯æŒ</li><li>è‡ªå®šä¹‰ Android ä¸»é¢˜</li><li>æ¢è‚¤</li></ol><p>Android åŸç”Ÿè‡ªå¸¦äº†å¤œé—´æ¨¡å¼çš„ APIï¼Œå¯ä»¥è®©<strong>æ–°åˆ›å»ºçš„é¡µé¢</strong>ä½¿ç”¨é…ç½®å¥½çš„å¤œé—´é¢œè‰²å€¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setDefaultNihgtMode</span><span class="params">(isNight: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">       AppCompatDelegate.setDefaultNightMode(<span class="keyword">if</span> (isNight) </span><br><span class="line">           AppCompatDelegate.MODE_NIGHT_YES <span class="keyword">else</span> AppCompatDelegate.MODE_NIGHT_NO)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå¯¹äºå·²ç»å¯åŠ¨å¥½çš„é¡µé¢åˆ™å¯ä»¥è°ƒç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setLocalNightMode</span><span class="params">(activity: <span class="type">AppCompatActivity</span>, isNight: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    activity.delegate.setLocalNightMode(<span class="keyword">if</span> (isNight) </span><br><span class="line">        AppCompatDelegate.MODE_NIGHT_YES <span class="keyword">else</span> AppCompatDelegate.MODE_NIGHT_NO)</span><br><span class="line">    activity.recreate()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼éœ€è¦ <code>setLocalNightMode</code> çš„ Activity åœ¨ AndroidManifest ä¸­è¦è®¾ç½® <code>android:configChanges=&quot;uiMode&quot;</code>ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆ~</p><p>è¿™ä¸ªæ–¹æ¡ˆå› ä¸ºé¡µé¢è¦é‡æ–°å¯åŠ¨ï¼Œæ‰€ä»¥å®é™…æ•ˆæœè¿˜è¾¾ä¸åˆ°äº§å“çš„è¦æ±‚â€¦â€¦</p><p><img src="https://i.loli.net/2020/04/09/lKoUPzNcH74Cagr.png" alt="udontwant.png"></p><p>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯é€šè¿‡æ”¹å˜ä¸»é¢˜çš„æ–¹å¼æ¥è®©åº”ç”¨ä½¿ç”¨ä¸åŒä¸»é¢˜ä¸‹çš„é¢œè‰²å€¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ—¥é—´ä¸»é¢˜ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>@color/colorPrimary<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>@color/colorPrimaryDark<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>@color/colorAccent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorBackground"</span>&gt;</span>@color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    ...</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¤œé—´ä¸»é¢˜ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"NightAppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>@color/colorPrimaryNihgt<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>@color/colorPrimaryDarkNight<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>@color/colorAccentNight<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorBackground"</span>&gt;</span>@color/gray<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    ...</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦å®šä¹‰ä¸¤ä¸ªå‘½åä¸€æ ·çš„é¢œè‰²åï¼Œåœ¨ä¸¤ç§ä¸»é¢˜ä¸‹ä½¿ç”¨ä¸åŒçš„é¢œè‰²å€¼ï¼Œåœ¨ä¸åŒçš„ä¸»é¢˜ä¸‹å¼•ç”¨ç›¸åº”çš„è‰²å€¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"?attr/colorAccent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@color/colorAccent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡é¢œè‰²çš„ä½¿ç”¨æ–¹å¼è¦ä» <code>@color</code> å˜æˆäº† <code>?attr</code>ï¼Œä¾‹å¦‚ä¸Šé¢çš„ <code>LinearLayout</code> çš„èƒŒæ™¯è‰²åˆ‡æ¢äº†å¤œé—´æ¨¡å¼åå°±å¯ä»¥ä½¿ç”¨å…¶ä»–é¢œè‰²ï¼Œè€Œ <code>TextView</code> çš„å­—ä½“é¢œè‰²è¿˜æ˜¯åŸæ¥çš„é¢œè‰²</p><p>å¦‚æœè¦æŠŠé¡¹ç›®ä¸­çš„æ‰€æœ‰é¢œè‰²å€¼çš„å¼•ç”¨æ–¹å¼éƒ½é€ä¸€æ›¿æ¢ï¼Œé‚£ä¹ˆå·¥ç¨‹é‡å¤ªå¤§äº†ï¼Œè¿™ä¸æˆ‘ä»¬ä¹‹å‰è¯´çš„ç¬¬äºŒç‚¹å’Œç¬¬ä¸‰ç‚¹å†²çª</p><p>ç¬¬ä¸‰ç§æ–¹å¼æ˜¯æ¢è‚¤æ–¹æ¡ˆï¼Œé€šè¿‡åŠ¨æ€æ›´æ¢ Resources æ¥è¾¾åˆ°å¤œé—´æ•ˆæœï¼Œè¿™ä¸ªæ–¹æ¡ˆå®ç°å’Œç»´æŠ¤æˆæœ¬è¾ƒå¤§ã€‚å¦‚æœæœ‰å¤šä¸»é¢˜æ ·å¼ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¯¥æ–¹æ¡ˆï¼Œä½†æ˜¯å¦‚æœåªæ˜¯ä¸ºäº†å®ç°å¤œé—´æ¨¡å¼æ¥è¯´ï¼Œä¸æ˜¯å¾ˆå€¼å¾—</p><p>éš¾é“å°±æ²¡æœ‰ä¸€ä¸ªå®Œç¾çš„æ–¹æ¡ˆæ¥å®ç°å¤œé—´æ¨¡å¼äº†ä¹ˆï¼Ÿè¿™ä¸ªè¿˜çœŸæ²¡æœ‰ï¼</p><p><img src="https://i.loli.net/2020/04/09/KOCH4WhrGZkfzv7.jpg" alt="tried.jpg"></p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç¬¬ä¸€ç§æ–¹æ¡ˆçš„é‡å¯é¡µé¢è¿›è¡Œä¼˜åŒ–ï¼Œè®©é¡µé¢é‡å¯å˜ä¸ºé¡µé¢åˆ·æ–°ï¼ŒåŠ ä¸Šä¸€ç‚¹ç‚¹åŠ¨ç”»ï¼Œå¤œé—´æ¨¡å¼çš„åˆ‡æ¢ç«‹é©¬å˜å¾—ä¼˜é›…èµ·æ¥äº†å‘¢~</p><p>åœ¨ Android ä¸­å¯ä»¥åˆ©ç”¨ <code>LayoutInflaterFactory</code> æ¥æ›¿æ¢ xml çš„æ§ä»¶ï¼ŒæŠŠåŸç”Ÿæ§ä»¶æ›¿æ¢æˆè‡ªå®šä¹‰æ§ä»¶ã€‚ç„¶åæˆ‘ä»¬å¯¹æ‰€æœ‰ã€Œæ´»ç€çš„ã€çš„ View é€’å½’è°ƒç”¨è‡ªå®šä¹‰æ§ä»¶ä¸­å°è£…å¥½çš„åˆ·æ–° UI çš„æ–¹æ³•ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜â€¦</p><p><img src="https://i.loli.net/2020/04/09/Lg1qr9kAmR5wF7P.jpg" alt="much_happy.jpg"></p><p>å®ç°æ€è·¯å·²ç»ç¡®å®šäº†ï¼Œæ¥ä¸‹æ¥æ¥çœ‹çœ‹ç»†èŠ‚çš„å®ç°ã€‚å¯¹äº RecyclerView åˆ—è¡¨æ¥è¯´ï¼Œå¸ƒå±€æ˜¯å¤ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯é‚£äº›æ²¡æœ‰è¢«é‡æ–°åˆ·æ–°çš„å¤ç”¨å¸ƒå±€ï¼Œå®ƒä»¬çš„é¢œè‰²çŠ¶æ€ä¼šå½±å“åˆ°æ–°åˆ›å»ºçš„é¡µé¢ï¼›ä¸Šé¢çš„æ–¹æ¡ˆæ˜¯é’ˆå¯¹ xml å¼•ç”¨çš„é¢œè‰²å€¼ï¼Œé‚£ä¹ˆä»£ç ä¸­å¼•ç”¨çš„é¢œè‰²å€¼ï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•å¤„ç†ï¼›æ›´å¤šå…·ä½“çš„ç»†èŠ‚å®ç°ä¼šåœ¨<a href="http://wenqin231.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/" target="_blank" rel="noopener">ã€ŒAndroid å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å±•å¼€è®²è®²ã€</a>ä¸­è®²è¿°</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>éšç€ç°åœ¨è¶Šæ¥è¶Šå¤šåº”ç”¨é‡è§†å¤œé—´æ¨¡å¼ï¼Œå¦‚æœç”¨æˆ·å¯¹ä½ çš„åº”ç”¨æœ‰å¤œé—´æ¨¡å¼çš„æœŸå¾…å¹¶ä¸”è®¾è®¡å¸ˆæœ‰ç›¸åº”çš„è®¾è®¡ï¼Œé‚£ä¹ˆå¤œé—´æ¨¡å¼è¿˜æ˜¯å¾ˆå€¼å¾—å°è¯•çš„ã€‚è™½ç„¶ç›®å‰æ²¡æœ‰ä¸€å¥—å®Œå–„çš„æ–¹æ¡ˆï¼ŒåŸç”Ÿçš„ API ä¹Ÿä¸æ˜¯ç‰¹åˆ«å‹å¥½ï¼Œä½†æ˜¯é€šè¿‡é€’å½’åˆ·æ–°æ§ä»¶çš„æ–¹å¼å¤§ä½“ä¸Šæ•ˆæœè¿˜æ˜¯ä»¤äººæ»¡æ„çš„~</p><h4 id="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "><a href="#å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« " class="headerlink" title="å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« "></a>å¤œé—´æ¨¡å¼ç³»åˆ—æ–‡ç« </h4><p><a href="http://wenqin231.com/2018/06/19/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%BC%80%E7%AF%87/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å¼€ç¯‡</a></p><p><a href="http://wenqin231.com/2018/08/08/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E5%B1%95%E5%BC%80%E8%AE%B2%E8%AE%B2/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”å±•å¼€è®²è®²</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”æºç åˆ†æ</a></p><p><a href="http://wenqin231.com/2018/08/09/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E8%B7%B5%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94QA/" target="_blank" rel="noopener">å¤œé—´æ¨¡å¼å®è·µæ¢ç´¢â€”â€”QA</a></p><p><em>å‚è€ƒèµ„æ–™</em></p><p><a href="https://medium.com/androiddevelopers/appcompat-v23-2-daynight-d10f90c83e94" target="_blank" rel="noopener">AppCompatâ€Šâ€”â€ŠDayNight</a></p><p><a href="https://www.jianshu.com/p/3b55e84742e5" target="_blank" rel="noopener">çŸ¥ä¹å’Œç®€ä¹¦çš„å¤œé—´æ¨¡å¼å®ç°å¥—è·¯</a></p><p><a href="https://www.uisdc.com/tencent-qq-night-mode" target="_blank" rel="noopener">è¶…è¿‡8äº¿äººä½¿ç”¨çš„QQï¼Œæ€»ç»“äº†å¤œé—´æ¨¡å¼è®¾è®¡çš„é€šç”¨æ–¹æ³•</a></p><p><strong>æ¬¢è¿å¤§å®¶æ¥<a href="http://okjike.com/careers" target="_blank" rel="noopener">å³åˆ»</a>æ‰¾æˆ‘ç©</strong>â¤ï¸</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;2018å¹´1æœˆï¼ŒYoutube å¯¹ ios å®¢æˆ·ç«¯ç°åº¦å‘å¸ƒå¤œé—´æ¨¡å¼ï¼›2018 WWDC ä¸Šï¼ŒMac OS æ·»åŠ äº†ç³»ç»Ÿçº§çš„å¤œé—´æ¨¡å¼åŠŸèƒ½ï¼Œå¯¹åº”ç”¨è¿›è¡Œå¤œé—´é€‚é…ï¼›18å¹´7æœˆï¼ŒYoutube å¯¹ Android å®¢æˆ·ç«¯ç°åº¦å‘å¸ƒäº†å¤œé—´æ¨¡å¼â€¦â€¦ è€Œåœ¨å›½å†…ï¼Œæ—©æœ‰ä¸€æ‰¹åº”ç”¨æ·»åŠ äº†å®ƒä»¬çš„å¤œé—´æ¨¡å¼ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨æ˜¯å¦éœ€è¦å¤œé—´æ¨¡å¼ï¼Œåˆè¯¥å¦‚ä½•é€‚é…å‘¢ï¼Ÿ æœ¬æ–‡å°†ä»åº”ç”¨éœ€æ±‚å’Œ Android å®ç°æ–¹æ¡ˆä¸¤ä¸ªè§’åº¦ç®€è¦è®²è¿°~&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/04/09/heNLlSRQ1IP4mrq.jpg&quot; alt=&quot;night_example.jpeg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
